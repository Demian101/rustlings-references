<!DOCTYPE html>
<html lang="en" id="oranda" class="dark">
    <head>
        <title>rustlings</title>
        
            <meta property="og:url" content="https://rustlings.cool" />
        
        
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
            <meta name="description" content="Small exercises to get you used to reading and writing Rust code!" />
            <meta property="og:description" content="Small exercises to get you used to reading and writing Rust code!" />
        
        <meta property="og:type" content="website" />
        <meta property="og:title" content="rustlings" />
        
        
        
        <meta http-equiv="Permissions-Policy" content="interest-cohort=()" />
        <link rel="stylesheet" href="/oranda-v0.3.1.css" />
        
        
    </head>
    <body>
        <div class="container">
            <div class="page-body">
                
                    <div class="repo_banner">
                        <a href="https://github.com/rust-lang/rustlings">
                            <div class="github-icon" aria-hidden="true"></div>
                            Check out our GitHub!
                        </a>
                    </div>
                

                <main>
                    <header>
                        
                        <h1 class="title">rustlings</h1>
                        
    <nav class="nav">
        <ul>
            <li><a href="/">Home</a></li>

            

            
                <li><a href="/artifacts/">Install</a></li>
            

            

            

            
                <li><a href="/changelog/">Changelog</a></li>
            
        </ul>
    </nav>

                    </header>

                    

<pre style="background-color:#263238;"><span style="color:#eeffff;">rustlings watch
</span></pre>

<h4>slice</h4>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">slice_out_of_array</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> a </span><span style="color:#89ddff;">= [</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">3</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">4</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">];
</span><span style="color:#eeffff;"> </span><span style="font-style:italic;color:#546e7a;">// let nice_slice = a[1..4];  Error!  ----|  对比
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> nice_slice </span><span style="color:#89ddff;">= &amp;</span><span style="color:#eeffff;">a</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">..</span><span style="color:#f78c6c;">4</span><span style="color:#89ddff;">];  -----------|
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">([</span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">3</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">4</span><span style="color:#89ddff;">],</span><span style="color:#eeffff;"> nice_slice</span><span style="color:#89ddff;">)
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// let nice_slice = a[1..4]; 
</span><span style="font-style:italic;color:#546e7a;">//                  ^^^ doesn't have a size known at compile-time
</span></pre>

<p>对比区别：<code>nice_slice</code> 有没有 <code>&amp;</code></p>
<ul>
<li><code>a[1..4]</code> 表达式表示从数组 <code>a</code> 中获取一个切片（slice），不是一个数组。</li>
<li>切片是对数组的引用 Ref，它允许您引用数组的一部分而不复制数据。因此，<code>a[1..4]</code> 表达式返回的类型是 <code>&amp;[i32]</code>，即对 <code>i32</code> 类型的切片的引用</li>
</ul>
<p>原因：</p>
<ul>
<li>在 Rust 中，局部变量 local variable 的大小必须在编译时是已知的，这就意味着变量必须实现 <code>Sized</code> trait。数组切片（slice）是一个动态大小类型（DST），它不实现 <code>Sized</code> trait，因为它的大小在编译时是不固定的</li>
<li><code>a[1..4];</code> 试图创建一个指向数组 <code>a</code> 中索引 <code>1</code> 到 <code>3</code> 的元素的切片。但由于切片是动态大小的，编译器无法确定 <code>nice_slice</code> 的大小，从而引发了错误。
修改：</li>
<li>考虑借用切片: borrowing the slice instead of owning it directly</li>
<li>这样，<code>nice_slice</code> 的类型将会是一个切片的引用 <code>&amp;[{integer}]</code>，这是一个固定大小的类型，编译器将不会报错</li>
</ul>
<blockquote>
<p><code>[i32, 16]</code> 这是一个分配在栈上的定长数组</p>
</blockquote>
<h4>tuple</h4>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> define tuple 
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> tup</span><span style="color:#89ddff;">: (</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#c792ea;">f64</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">) = (</span><span style="color:#f78c6c;">500</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">6.4</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">);
</span></pre>

<pre style="background-color:#263238;"><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> tuple destructuring</span><span style="color:#89ddff;">...
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> cat </span><span style="color:#89ddff;">= ("</span><span style="color:#c3e88d;">Furry McFurson</span><span style="color:#89ddff;">", </span><span style="color:#f78c6c;">3.5</span><span style="color:#89ddff;">);
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">name</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> age</span><span style="color:#89ddff;">)  =</span><span style="color:#eeffff;"> cat</span><span style="color:#89ddff;">;      </span><span style="font-style:italic;color:#546e7a;">// Attention
</span></pre>

<h4>Vec</h4>
<p>Create vec :</p>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> method </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">: </span><span style="color:#ffcb6b;">Vec</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new 后 不断 </span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">()
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> v </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">Vec</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">v.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">  v.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">20</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">  v.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">30</span><span style="color:#89ddff;">);</span><span style="color:#eeffff;">    v.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">40</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> method </span><span style="color:#f78c6c;">2 </span><span style="color:#89ddff;">- </span><span style="color:#c792ea;">use </span><span style="background-color:#ff5370;color:#ffffff;">macro</span><span style="color:#eeffff;"> vec</span><span style="color:#89ddff;">! 
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> v </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">20</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">30</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">40</span><span style="color:#89ddff;">]
</span></pre>

<pre style="background-color:#263238;"><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> 将 v 这个 vec 里的每一个元素都 </span><span style="color:#89ddff;">*</span><span style="color:#f78c6c;">2 
</span><span style="font-style:italic;color:#546e7a;">// v = vec![2, 4, 6, 8, 10];
</span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> ele </span><span style="color:#89ddff;">in</span><span style="color:#eeffff;"> v.</span><span style="color:#82aaff;">iter_mut</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;"> </span><span style="font-style:italic;color:#546e7a;">// *ele * 2   // Error ~~ expected `()`, found `i32`
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">*</span><span style="color:#eeffff;">ele </span><span style="color:#89ddff;">*= </span><span style="color:#f78c6c;">2
</span><span style="color:#89ddff;">}
</span></pre>

<p>注意，</p>
<ul>
<li><code>v.iter_mut()</code> 返回一个可变 Iterator，会逐个产生向量 <code>v</code> 中元素的可变引用 (<code>&amp;mut i32</code>)</li>
<li>注释中  <code>*ele * 2</code>  的Error 是因为这个表达式计算了 <code>ele * 2</code> ，但没有将计算的结果赋回元素，<code>for</code> 循环的每次迭代都有一个表达式，Rust 要求这个表达式的类型必须是 <code>()</code>（单元类型），我们这里产生的是 <code>i32</code> 类型</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#eeffff;">v.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">map</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">ele</span><span style="color:#89ddff;">| {
</span><span style="color:#eeffff;">	ele </span><span style="color:#89ddff;">* </span><span style="color:#f78c6c;">2  </span><span style="font-style:italic;color:#546e7a;">// ✅
</span><span style="color:#89ddff;">})</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">()
</span></pre>

<ul>
<li>这段代码使用的是 map 函数，而不是上面的 for 循环</li>
<li>闭包 <code>|ele| ele * 2</code> 接收一个元素引用 <code>ele</code>( &amp;i32 )，并计算它的两倍</li>
</ul>
<h4>move semantics</h4>
<p>move semantics <sup class="footnote-ref"><a href="#fn-1" id="fnref-1" rel="noopener noreferrer">1</a></sup></p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">fill_vec</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">vec</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">&gt;) -&gt; </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    vec.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">88</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    vec
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li>观察参数，如果要改变 vec ，则需要在传参时指定其 mut</li>
<li>为什么不在调用时写 mut ? 比如 <code>fill_vec(&amp;mut vec0)</code> ?
<ul>
<li>函数参数的可变性是在<strong>函数签名</strong>中定义的，而不是在函数调用时确定的。换句话说，当你传递一个变量给函数时，是否可以在函数内部修改这个变量取决于函数参数的定义</li>
<li><code>mut</code> 关键字是用于变量声明的，它定义了变量的可变性，而不是变量的使用方式</li>
</ul>
</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> vec1 </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">fill_vec</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">vec0</span><span style="color:#89ddff;">);
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;">     vec1 </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">fill_vec</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">vec0</span><span style="color:#89ddff;">);
</span></pre>

<ul>
<li>如上所述，2 种定义方法都是正确的，只是变量定义的可变性不同</li>
</ul>
<h4>match</h4>
<p>有些 match 代码挺难写的，下面的例子做错，要仔细看</p>
<p>如下代码：</p>
<ul>
<li>enum Message 代表了消息类型，比如 <code>移动</code>, <code>发声</code>, <code>变色</code>, <code>退出</code> ..</li>
<li>struct State 代表(一个角色) 目前的状态，比如 <code>颜色, 位置, 消息 Message</code></li>
<li>然后为 struct State 实现针对状态的各种函数 change_color() , quit() , echo() , ...</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">Message </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">  Move </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">},
</span><span style="color:#eeffff;">  Echo</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">  ChangeColor</span><span style="color:#89ddff;">(</span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">  Quit
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Point </span><span style="color:#89ddff;">{ </span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">, y</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">, </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">State </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">  color</span><span style="color:#89ddff;">: (</span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">, </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">, </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">  position</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Point,
</span><span style="color:#eeffff;">  quit</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">bool</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">  message</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> String,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">State </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">change_color</span><span style="color:#89ddff;">(&amp;</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">color</span><span style="color:#89ddff;">: (</span><span style="color:#f78c6c;">u8</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">u8</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">u8</span><span style="color:#89ddff;">)) { </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.color </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> color</span><span style="color:#89ddff;">; }
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">quit</span><span style="color:#89ddff;">(&amp;</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">self</span><span style="color:#89ddff;">) { </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.quit </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">true</span><span style="color:#89ddff;">; }
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">echo</span><span style="color:#89ddff;">(&amp;</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">s</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> String</span><span style="color:#89ddff;">) { </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.message </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> s </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">move_position</span><span style="color:#89ddff;">(&amp;</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">p</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Point</span><span style="color:#89ddff;">) { </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.position </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> p</span><span style="color:#89ddff;">; }
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(&amp;</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">message</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Message</span><span style="color:#89ddff;">) {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// TODO: create a match expression to process the different message
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> message </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">      Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">ChangeColor</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">r</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> g</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> b</span><span style="color:#89ddff;">) =&gt; </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">change_color</span><span style="color:#89ddff;">((</span><span style="color:#eeffff;">r</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> g</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> b</span><span style="color:#89ddff;">)),
</span><span style="color:#eeffff;">      Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Quit </span><span style="color:#89ddff;">=&gt; </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">quit</span><span style="color:#89ddff;">(),
</span><span style="color:#eeffff;">      Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Echo</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">s</span><span style="color:#89ddff;">) =&gt; </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">echo</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">s</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">      Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Move </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y </span><span style="color:#89ddff;">} =&gt; </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">move_position</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Point </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y </span><span style="color:#89ddff;">}),     } } }
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// 调用逻辑：
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">test_match_message_call</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> state </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> State </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">      quit</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">false</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">      position</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Point </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">},
</span><span style="color:#eeffff;">      color</span><span style="color:#89ddff;">: (</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">      message</span><span style="color:#89ddff;">: "</span><span style="color:#c3e88d;">hello world</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">(),
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">    state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">ChangeColor</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">255</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">255</span><span style="color:#89ddff;">));
</span><span style="color:#eeffff;">    state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Echo</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Hello world!</span><span style="color:#89ddff;">")));
</span><span style="color:#eeffff;">    state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Move </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">15 </span><span style="color:#89ddff;">});
</span><span style="color:#eeffff;">    state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Quit</span><span style="color:#89ddff;">);
</span></pre>

<p><strong>match 匹配模式讲解：</strong> <code>match message</code> 将 <code>message</code> 与四个模式进行匹配：</p>
<ol>
<li><code>Message::ChangeColor(r, g, b)</code>：如果 <code>message</code> 是 <code>ChangeColor</code> 变量，将其三个字段绑定到 <code>r</code>、<code>g</code> 和 <code>b</code>，然后执行 <code>self.change_color((r as u8, g as u8, b as u8))</code></li>
<li><code>Message::Quit</code>：如果 <code>message</code> 是 <code>Quit</code> 变量，执行 <code>self.quit()</code></li>
<li><code>Message::Echo(s)</code>：如果 <code>message</code> 是 <code>Echo</code> 变量，将其字段绑定到 <code>s</code>，然后执行 <code>self.echo(s)</code></li>
<li><code>Message::Move { x, y }</code>：如果 <code>message</code> 是 <code>Move</code> 变量，将其字段 <code>x</code> 和 <code>y</code> 绑定到变量 <code>x</code> 和 <code>y</code>，然后执行 <code>self.move_position(Point { x, y })</code></li>
</ol>
<pre style="background-color:#263238;"><span style="color:#eeffff;">state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Move </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">15 </span><span style="color:#89ddff;">});
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#546e7a;">// Message::Move{x, y} =&gt; self.move_position(Point { x, y })
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">ChangeColor</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">255</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">255</span><span style="color:#89ddff;">)); 
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#546e7a;">// Message::ChangeColor(r, g, b) =&gt; self.change_color((r, g, b)),
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Echo</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Hello world!</span><span style="color:#89ddff;">")));
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#546e7a;">//  Message::Echo(s) =&gt; self.echo(s),
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">state.</span><span style="color:#82aaff;">process</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Quit</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#546e7a;">// Message::Quit =&gt; self.quit(),
</span></pre>

<ul>
<li>为什么 <code>change_color((</code> 用了 2 个括号？
<ul>
<li>因为传入的是元组 tuple 作为参数  ( When passing a tuple as a function argument, you'll need extra parentheses: fn function((t, u, p, l, e))</li>
</ul>
</li>
</ul>
<p>match 和所有权转移:</p>
<ul>
<li>试 fix 如下代码，使得 y 在 match 模式匹配后仍然可以继续使用</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> y </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">	</span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">p</span><span style="color:#89ddff;">) =&gt; </span><span style="color:#eeffff;">println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Co-ordinates are </span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;">,</span><span style="color:#eeffff;">{} </span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> p.x</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> p.y</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">_ =&gt; </span><span style="color:#eeffff;">panic!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">no match!</span><span style="color:#89ddff;">"),
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">y</span><span style="color:#89ddff;">;
</span></pre>

<ul>
<li>Solution:
<ul>
<li>只需把 <code>match y</code> 改成 <code>match &amp;y</code> 即可</li>
<li>模式匹配时，Rust 会自动进行<code>解引用</code>，让我们能够匹配引用指向的内容</li>
</ul>
</li>
</ul>
<h4>String</h4>
<p>简易方法创建一个多行字符串：</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">get_results</span><span style="color:#89ddff;">() -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> results </span><span style="color:#89ddff;">= ""</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">            </span><span style="color:#89ddff;">+ "</span><span style="color:#c3e88d;">England,France,4,2</span><span style="color:#89ddff;">\n"
</span><span style="color:#eeffff;">            </span><span style="color:#89ddff;">+ "</span><span style="color:#c3e88d;">France,Italy,3,1</span><span style="color:#89ddff;">\n"
</span><span style="color:#eeffff;">            </span><span style="color:#89ddff;">+ "</span><span style="color:#c3e88d;">Poland,Spain,2,0</span><span style="color:#89ddff;">\n"
</span><span style="color:#eeffff;">            </span><span style="color:#89ddff;">+ "</span><span style="color:#c3e88d;">Germany,England,2,1</span><span style="color:#89ddff;">\n";
</span><span style="color:#eeffff;">        results
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span></pre>

<hr>
<p>现在，对 <code>&amp;str</code> 有 3 个需求：分别是 <code>trim</code>, <code>拼接</code> 和 <code>替换</code></p>
<ul>
<li>观察下面函数的实现：</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">trim_me</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">input</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    input.</span><span style="color:#82aaff;">trim</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">compose_me</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">input</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    format!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;"> world!</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> input</span><span style="color:#89ddff;">)  </span><span style="font-style:italic;color:#546e7a;">// hello world! ; GM world!
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">replace_me</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">input</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// TODO: Replace "cars" in the string with "balloons"!
</span><span style="color:#eeffff;">    input.</span><span style="color:#82aaff;">replace</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">cars</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">balloons</span><span style="color:#89ddff;">")
</span><span style="color:#89ddff;">}
</span></pre>

<p><strong>为什么 <code>trim()</code> 后要 <code>to_string()</code> ?</strong></p>
<ul>
<li>函数定义要求：将<code> trim()</code> 后的 <code>&amp;str</code> 转换成 <code>String</code> 类型</li>
</ul>
<p><strong>为什么不直接把 <code>trim()</code> 定义到 String 上面？</strong></p>
<ul>
<li>①  <code>String</code> 和 <code>&amp;str</code>（字符串切片）是两种不同的字符串表示方式。<code>String</code> 是一个可增长、可修改、拥有所有权的字符串类型，而 <code>&amp;str</code> 是一个不可变引用到字符串的切片</li>
<li>② <code>trim()</code> 方法定义在 <code>&amp;str</code> 上是因为该方法不需要修改原始字符串的内容或改变字符串的长度，它仅仅是返回原字符串中的一个子切片（不包含前后的空白字符）。由于 <code>&amp;str</code> 是不可变的，这使得使用 <code>trim()</code> 方法非常安全和高效，不涉及额外的字符串分配或复制。</li>
<li>③ 如果 <code>trim()</code> 方法定义在 <code>String</code> 上，那么它可能会给人一种错误的印象：即该方法会修改 <code>String</code> 的内容</li>
<li>④ 将 <code>trim()</code> 方法定义在 <code>&amp;str</code> 上使得它可以作用于任何字符串切片，无论它是从 <code>String</code> 还是字面量字符串 <code>&amp;'static str</code> 获得的，这增加了该方法的通用性和灵活性。如果你有一个 <code>String</code> 对象并想使用 <code>trim()</code>，你可以轻松地通过调用 <code>as_str()</code> 方法或者使用 <code>&amp;</code> 引用 或者 Deref 来获得一个 <code>&amp;str</code> 引用，然后再调用 <code>trim()</code> 方法，如下代码</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> s </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">  Hello, World!  </span><span style="color:#89ddff;">");
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> trimmed </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> s.</span><span style="color:#82aaff;">trim</span><span style="color:#89ddff;">();  </span><span style="font-style:italic;color:#546e7a;">// 这里 String 会自动 Deref 到 &amp;str 类型
</span></pre>

<hr>
<p>请你说说下面这些表达式的类型，<code>&amp;str</code>   or   <code>String</code> ？(后面有答案)</p>
<pre style="background-color:#263238;"><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">red</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">()
</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">hi</span><span style="color:#89ddff;">")
</span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">rust is fun!</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_owned</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">nice weather</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">into</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">format!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Interpolation </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">Station</span><span style="color:#89ddff;">") </span><span style="font-style:italic;color:#546e7a;">// Error
</span><span style="color:#89ddff;">&amp;</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">abc</span><span style="color:#89ddff;">")[</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">..</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">]
</span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">  hello there </span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">trim</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">Happy Monday!</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">replace</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Mon</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">Tues</span><span style="color:#89ddff;">") </span><span style="font-style:italic;color:#546e7a;">// Error
</span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">mY sHiFt KeY iS sTiCkY</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_lowercase</span><span style="color:#89ddff;">() </span><span style="font-style:italic;color:#546e7a;">// Error
</span><span style="color:#eeffff;">
</span></pre>

<p>Answer :</p>
<pre style="background-color:#263238;"><span style="color:#89ddff;">&amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;"> slice</span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">blue</span><span style="color:#89ddff;">"
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">&amp;</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">abc</span><span style="color:#89ddff;">")[</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">..</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">  hello there </span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">trim</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">
</span><span style="color:#ffcb6b;">String </span><span style="color:#89ddff;">:
</span><span style="color:#eeffff;">  </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">hi</span><span style="color:#89ddff;">")
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">rust is fun!</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_owned</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">nice weather</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">into</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">  format!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Interpolation </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">Station</span><span style="color:#89ddff;">")
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">Happy Monday!</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">replace</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Mon</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">Tues</span><span style="color:#89ddff;">")
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">mY sHiFt KeY iS sTiCkY</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_lowercase</span><span style="color:#89ddff;">()
</span></pre>

<ul>
<li><code>"blue"</code> 是字符串字面量，类型为 <code>&amp;str</code></li>
<li><code>"nice weather".into()</code> 利用 <code>into</code> 方法将 <code>&amp;str</code> 转换为 <code>String</code></li>
<li><code>format!</code> 宏返回一个 <code>String</code></li>
<li><code>.trim()</code> 返回一个 <code>&amp;str</code></li>
<li><code>replace</code> 方法返回一个新的 <code>String</code></li>
<li><code>to_lowercase</code> 方法返回一个新的 <code>String</code></li>
</ul>
<p><code>to_owned</code>：</p>
<ul>
<li><code>to_owned()</code> 是 <code>ToOwned</code> trait 的一部分。这个 trait 通常用于从 <code>借用类型</code> 创建 Owned 类型，例如从 <code>&amp;str</code> 创建 <code>String</code>，或从切片 <code>&amp;[T]</code> 创建 <code>Vec&lt;T&gt;</code></li>
<li>"owned 类型" 通常指的是拥有其内容的值的类型。例如，<code>String</code> 是 <code>&amp;str</code> 的 owned 版本，<code>Vec&lt;T&gt;</code> 是切片 <code>&amp;[T]</code> 的 owned 版本。Owned 类型的值在堆上分配内存，当它们离开作用域时，它们的析构函数会被调用，内存会被释放</li>
<li>这个方法在 <code>&amp;str</code> 上调用时会创建一个新的堆分配的字符串（<code>String</code>）</li>
</ul>
<h4>HashMap</h4>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> fruit_kinds </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[
</span><span style="color:#eeffff;">	Fruit</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Apple</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">	Fruit</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Banana</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#546e7a;">// ...
</span><span style="color:#89ddff;">];
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> fruit </span><span style="color:#89ddff;">in</span><span style="color:#eeffff;"> fruit_kinds </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">if </span><span style="color:#89ddff;">!</span><span style="color:#eeffff;">basket.</span><span style="color:#82aaff;">contains_key</span><span style="color:#89ddff;">(&amp;</span><span style="color:#eeffff;">fruit</span><span style="color:#89ddff;">) {
</span><span style="color:#eeffff;">		basket.</span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">fruit</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<p>为什么 <code>contains_key(&amp;fruit)</code> 用 <code>&amp;</code> ， 但是 <code>basket.insert(fruit, 1);</code> 不用 <code>&amp;</code>  ？</p>
<p><strong><code>contains_key</code> 方法</strong>：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">contains_key</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">Q</span><span style="color:#89ddff;">: </span><span style="background-color:#ff5370;color:#ffffff;">?</span><span style="color:#ffcb6b;">Sized</span><span style="color:#89ddff;">&gt;(&amp;</span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> k</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">Q</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">bool
</span><span style="color:#c792ea;">where
</span><span style="color:#eeffff;">    K</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Borrow</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">Q</span><span style="color:#89ddff;">&gt;,     
</span><span style="color:#eeffff;">    Q</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Hash </span><span style="color:#89ddff;">+ </span><span style="color:#ffcb6b;">Eq</span><span style="color:#89ddff;">,
</span></pre>

<p><code>contains_key</code> 只需要一个对键的引用（<code>&amp;Q</code>），因为它不会更改键或哈希映射的状态。由于它仅需要引用，我们使用 <code>&amp;fruit</code> 来传递对键的引用</p>
<p><strong><code>insert</code> 方法</strong>：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(&amp;</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">k</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> K, </span><span style="color:#f78c6c;">v</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> V</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Option</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">V</span><span style="color:#89ddff;">&gt;
</span></pre>

<p><code>insert</code> 方法需要键的所有权，因为哈希映射需要存储该键。由于 <code>Fruit</code> 枚举实现了 <code>Copy</code> trait，当我们调用 <code>insert(fruit, 1)</code> 时，实际上是复制了一个 <code>fruit</code> 的副本传递给 <code>insert</code> 方法，因此我们不需要使用引用 <code>&amp;</code></p>
<hr>
<p>需求：每次循环，都会给出球队 和 得分情况，比如：<code>德国,英格兰,3,1</code> , 意思就是比分： <code>德国: 英国= 3: 1</code> ， 即</p>
<ul>
<li>德国得分： 3，失分： 1</li>
<li>英国得分： 1，失分： 3</li>
<li>不断循环，给出最后每个球队的总得分和总失分</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Team </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    goals_scored</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">,    </span><span style="font-style:italic;color:#546e7a;">// 得分
</span><span style="color:#eeffff;">    goals_conceded</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">,  </span><span style="font-style:italic;color:#546e7a;">// 失分
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> scores</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">HashMap</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String, Team</span><span style="color:#89ddff;">&gt; = </span><span style="color:#eeffff;">HashMap</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">();
</span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> r </span><span style="color:#89ddff;">in</span><span style="color:#eeffff;"> results.</span><span style="color:#82aaff;">lines</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">   </span><span style="font-style:italic;color:#546e7a;">// ... 
</span><span style="color:#eeffff;">   </span><span style="font-style:italic;color:#546e7a;">// .. team_1_name,team_1_score,  team_2_name,team_2_score,
</span><span style="color:#eeffff;">   </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> team_1 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> scores
</span><span style="color:#eeffff;">      .</span><span style="color:#82aaff;">entry</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">team_1_name</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">      .</span><span style="color:#82aaff;">or_insert_with</span><span style="color:#89ddff;">(|| </span><span style="color:#eeffff;">Team </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> goals_scored</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> goals_conceded</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">});
</span><span style="color:#eeffff;">    team_1.goals_scored </span><span style="color:#89ddff;">+=</span><span style="color:#eeffff;"> team_1_score</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    team_1.goals_conceded </span><span style="color:#89ddff;">+=</span><span style="color:#eeffff;"> team_2_score</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> team_2 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> scores
</span><span style="color:#eeffff;">       .</span><span style="color:#82aaff;">entry</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">team_2_name</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">       .</span><span style="color:#82aaff;">or_insert_with</span><span style="color:#89ddff;">(|| </span><span style="color:#eeffff;">Team </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> goals_scored</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> goals_conceded</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">});
</span><span style="color:#eeffff;">	team_2.goals_scored </span><span style="color:#89ddff;">+=</span><span style="color:#eeffff;"> team_2_score</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">	team_2.goals_conceded </span><span style="color:#89ddff;">+=</span><span style="color:#eeffff;"> team_1_score</span><span style="color:#89ddff;">;
</span></pre>

<p><code>scores.entry</code> : 查找 HashMap <code>scores</code> 中是否存在 <code>team_1_name</code> 这个 key ：</p>
<ul>
<li>If so，返回这个 key 对应的 mut ref，即 <code>team_1</code> 对应的 <code>Team</code> struct 实例的引用</li>
<li>If not，它会使用 <code>or_insert_with</code> 方法中的闭包 <code>|| Team { goals_scored: 0, goals_conceded: 0 }</code> 创建一个新的 <code>Team</code> 实例，并将其插入 HashMap，然后返回这个新值的可变引用</li>
</ul>
<h4>Exercise 2 (中期 Exercise)</h4>
<p>给定一组<code>[字符串]</code>和<code>[命令]</code>，返回一个 <code>vec![]</code> ,  里面存放着操作后的字符串。如：</p>
<ul>
<li>input:<code> ("hello".into(), Command::Uppercase),</code></li>
<li>output: <code>HELLO</code></li>
<li>注：字符串是 "hello"， 命令是 Uppercase，结果是 "HELLO"</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">Command </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">  Uppercase</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">  Trim</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">  Append</span><span style="color:#89ddff;">(</span><span style="font-style:italic;color:#c792ea;">usize</span><span style="color:#89ddff;">), </span><span style="font-style:italic;color:#546e7a;">// 添加 n 次 'bar' 到字符串屁股后面.
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">mod </span><span style="color:#eeffff;">my_module </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">  </span><span style="color:#c792ea;">use super</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Command</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">  </span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">transformer</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">input</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;(</span><span style="color:#eeffff;">String, Command</span><span style="color:#89ddff;">)&gt;) -&gt; </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> output</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String</span><span style="color:#89ddff;">&gt; = </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// 由于我们要消耗 input，因此使用 into_iter 而不是 iter
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">for </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">string</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> command</span><span style="color:#89ddff;">) in</span><span style="color:#eeffff;"> input.</span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">() { 
</span><span style="color:#eeffff;">      </span><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> command </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        Command</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Uppercase </span><span style="color:#89ddff;">=&gt;</span><span style="color:#eeffff;"> output.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">string.</span><span style="color:#82aaff;">to_uppercase</span><span style="color:#89ddff;">()),
</span><span style="color:#eeffff;">        Command</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Trim </span><span style="color:#89ddff;">=&gt;</span><span style="color:#eeffff;"> output.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">string.</span><span style="color:#82aaff;">trim</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">()),
</span><span style="color:#eeffff;">        Command</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Append</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">n</span><span style="color:#89ddff;">) =&gt; {
</span><span style="color:#eeffff;">          </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> s </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> string</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">          </span><span style="font-style:italic;color:#c792ea;">for </span><span style="color:#89ddff;">_ in </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">..</span><span style="color:#eeffff;">n </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> s.</span><span style="color:#82aaff;">push_str</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">bar</span><span style="color:#89ddff;">"); }
</span><span style="color:#eeffff;">          output.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">s</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">      </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    output
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">cfg</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">mod </span><span style="color:#eeffff;">tests </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#546e7a;">// TODO: What do we need to import to have `transformer` in scope?
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#546e7a;">// use my_module::transformer;
</span><span style="color:#eeffff;">  </span><span style="color:#c792ea;">use super</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">my_module</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">transformer</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">  </span><span style="color:#c792ea;">use super</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Command</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">it_works</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> output </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">transformer</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[
</span><span style="color:#eeffff;">      </span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">hello</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">into</span><span style="color:#89ddff;">(), </span><span style="color:#eeffff;">Command</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Uppercase</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">      </span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;"> all roads lead to rome! </span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">into</span><span style="color:#89ddff;">(), </span><span style="color:#eeffff;">Command</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Trim</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">      </span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">foo</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">into</span><span style="color:#89ddff;">(), </span><span style="color:#eeffff;">Command</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Append</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">)),
</span><span style="color:#eeffff;">      </span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">bar</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">into</span><span style="color:#89ddff;">(), </span><span style="color:#eeffff;">Command</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Append</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">)),
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">]);
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">output</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">], "</span><span style="color:#c3e88d;">HELLO</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">output</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">], "</span><span style="color:#c3e88d;">all roads lead to rome!</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">output</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">], "</span><span style="color:#c3e88d;">foobar</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">output</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">3</span><span style="color:#89ddff;">], "</span><span style="color:#c3e88d;">barbarbarbarbarbar</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>use super::my_module::transformer;</code>:
<ul>
<li>仔细体会，<code> mod xxxx</code> 创建的是一个一个命名空间</li>
<li>使用 <code>super</code> 来回溯上一级</li>
</ul>
</li>
<li><code>Vec&lt;(String, Command)</code> :  <code>Vec&lt;&gt;</code> 里存放的是 <code>()</code> tuple</li>
<li><code>into_iter()</code> instead of  <code>iter()</code> :
<ul>
<li><code>iter()</code> 返回一个不可变引用的迭代器  <code>Iterator&lt;Item=&amp;T&gt;</code></li>
<li><code>into_iter()</code> 会获取集合的所有权并返回一个值的迭代器<code>Iterator&lt;Item=T&gt;</code></li>
</ul>
</li>
<li><code>"hello".into()</code> :
<ul>
<li>"hello" 是一个 string literal，是个 <code>&amp;str</code> 类型，为了匹配 transformer 函数的参数，需调用 <code>.into</code> 将其转为 <code>String</code></li>
</ul>
</li>
</ul>
<h4>Control flow</h4>
<p>如下代码使用 <code>if let Some(word)</code> 试探究使用 <code>Some</code> 的合理性</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> target </span><span style="color:#89ddff;">= "</span><span style="color:#c3e88d;">rustlings</span><span style="color:#89ddff;">";
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// optional_target 是个 Optional 类型
</span><span style="font-style:italic;color:#c792ea;">if let </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">word</span><span style="color:#89ddff;">) =</span><span style="color:#eeffff;"> optional_target </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#546e7a;">// 代码块，如果 expression 匹配 Some(pattern)，则执行这里的代码
</span><span style="color:#eeffff;">	assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">word</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> target</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>Some(pattern)</code> 是我们要匹配的模式，其中 <code>pattern</code> 是我们想要从 <code>Some</code> variant 中提取的值
<ul>
<li>如果 <code>optional_target</code> 是 <code>Some()</code> variant（即不是 <code>None</code>），则将其中包含的值绑定到变量 <code>word</code> 上，所以 <code>word</code> 的类型是 <code>Option</code> 中包含的类型，即 <code>&amp;str</code></li>
<li>所以 <code>if let Some(xx)</code> 就相当于是个解包，把原本包在 <code>Some(xx)</code> 里的 xx 给 <strong>脱壳</strong></li>
</ul>
</li>
</ul>
<p>如下代码使用 <code>Some(Some(integer))</code> , 试探究 :</p>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">layered_option</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> range </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> optional_integers</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">Option</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i8</span><span style="color:#89ddff;">&gt;&gt; = </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[</span><span style="color:#ffcb6b;">None</span><span style="color:#89ddff;">];
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> i </span><span style="color:#89ddff;">in </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">..(</span><span style="color:#eeffff;">range </span><span style="color:#89ddff;">+ </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">) {
</span><span style="color:#eeffff;">		optional_integers.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">i</span><span style="color:#89ddff;">));
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> cursor </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> range</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#546e7a;">// TODO: make this a while let statement - remember that vector.pop also
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#546e7a;">// adds another layer of Option&lt;T&gt;. You can stack `Option&lt;T&gt;`s into
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#546e7a;">// while let and if let.
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">while let </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">integer</span><span style="color:#89ddff;">)) =</span><span style="color:#eeffff;"> optional_integers.</span><span style="color:#82aaff;">pop</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">		assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">integer</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> cursor</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">		cursor </span><span style="color:#89ddff;">-= </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">	assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">cursor</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>Some(Some(integer)) : </code>
<ul>
<li><code>pop()</code> 方法本身会返回一个 <code>Option&lt;T&gt;</code> 类型</li>
</ul>
</li>
</ul>
<h4>error_handling</h4>
<h5>使用 Result</h5>
<p>Result 处理字符串为空 <code>""</code> 时的情况，我们报一个带信息的 Error !</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// 我一开始写的代码 ❌：
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">generate_nametag_text</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">name</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> String</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Option</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> name.</span><span style="color:#82aaff;">is_empty</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#546e7a;">// Empty names aren't allowed.
</span><span style="color:#eeffff;">        Result</span><span style="color:#89ddff;">&lt;</span><span style="background-color:#ff5370;color:#ffffff;">"</span><span style="color:#eeffff;">Error</span><span style="color:#89ddff;">!"</span><span style="color:#c3e88d;">&gt; // 这什么东西？？
</span><span style="color:#c3e88d;">    } else {
</span><span style="color:#c3e88d;">        Some(format!(</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">Hi</span><span style="color:#89ddff;">!</span><span style="color:#eeffff;"> My name is </span><span style="color:#89ddff;">{}"</span><span style="color:#c3e88d;">, name))
</span><span style="color:#c3e88d;">    }
</span><span style="color:#c3e88d;">}
</span><span style="color:#c3e88d;">
</span><span style="color:#c3e88d;">// Solution ✅
</span><span style="color:#c3e88d;">pub fn generate_nametag_text(name: String) -&gt; Result&lt;String, String&gt; {
</span><span style="color:#c3e88d;">    if name.is_empty() {
</span><span style="color:#c3e88d;">        // Empty names aren't allowed.
</span><span style="color:#c3e88d;">        Err(</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">`name` was empty</span><span style="color:#89ddff;">;</span><span style="color:#eeffff;"> it must be nonempty.</span><span style="color:#89ddff;">"</span><span style="color:#c3e88d;">.into())
</span><span style="color:#c3e88d;">    } else {
</span><span style="color:#c3e88d;">        Ok(format!(</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">Hi</span><span style="color:#89ddff;">!</span><span style="color:#eeffff;"> My name is </span><span style="color:#89ddff;">{}"</span><span style="color:#c3e88d;">, name))
</span><span style="color:#c3e88d;">    }
</span><span style="color:#c3e88d;">}
</span></pre>

<ul>
<li>返回值由 <code>Result&lt;T, E&gt;</code>  instead of  <code>Option&lt;T&gt;</code></li>
<li><code>Err("xxx".into())</code>
<ul>
<li><code>Err()</code> 里面要包含一个 String 来指示具体的错误</li>
<li>why <code>.into()</code> ?
<ul>
<li>因为 "xxx" 是一个 String lateral 是 <code>&amp;str</code> 类型，所以需要 <code>.into()</code> 转成 String</li>
</ul>
</li>
</ul>
</li>
<li>正常的值是用 <code>Ok()</code> wrap 起来的，使用的时候需要解包，如：</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> result </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">generate_nametag_text</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">John</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">into</span><span style="color:#89ddff;">());
</span><span style="color:#eeffff;">    
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">if let </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">name_tag</span><span style="color:#89ddff;">) =</span><span style="color:#eeffff;"> result </span><span style="color:#89ddff;">{ </span><span style="font-style:italic;color:#546e7a;">// use Ok to deconstruct
</span><span style="color:#eeffff;">        println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Generated nametag: </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> name_tag</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// ....
</span></pre>

<hr>
<h5>使用 ?</h5>
<p>如下函数：用户输入一个字符串数字，我们将其解析为数字，如果用户输入的东西不能被解析为数字，比如他输入了 “beep beep”，我们需要 raise 一个 <code>ParseError</code> !</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// unfinished wrong code ❌:
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">total_cost</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">item_quantity</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">, ParseIntError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> qty </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> item_quantity.parse</span><span style="color:#89ddff;">::&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">&gt;();
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> processing_fee </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> cost_per_item </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">qty </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;"> cost_per_item </span><span style="color:#89ddff;">+</span><span style="color:#eeffff;"> processing_fee</span><span style="color:#89ddff;">)
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// Solution ✅
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">total_cost</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">item_quantity</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">, ParseIntError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> qty </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> item_quantity.parse</span><span style="color:#89ddff;">::&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">&gt;()?;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// ...
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// 调用
</span><span style="font-style:italic;color:#c792ea;">if let </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">cost</span><span style="color:#89ddff;">) = </span><span style="color:#82aaff;">total_cost</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">user_input</span><span style="color:#89ddff;">) {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// 对绑定到 cost variant 的处理代码 ....
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li>只在 parse 后面加了一个  <code>?</code> 就解决了</li>
<li><code>?</code>  用于简化 <code>Result</code> Error handle,</li>
</ul>
<p>Below is a trivial solution ✅ ，虽然正确，但还要 Pattern match <code>parse()</code> 的 return value，不美观：</p>
<pre style="background-color:#263238;"><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">total_cost</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">item_quantity</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">, ParseIntError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> processing_fee </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> cost_per_item </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// 使用 match 表达式显式处理 Result
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> qty </span><span style="color:#89ddff;">= </span><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> item_quantity.parse</span><span style="color:#89ddff;">::&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">&gt;() {
</span><span style="color:#eeffff;">        </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">value</span><span style="color:#89ddff;">) =&gt;</span><span style="color:#eeffff;"> value</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#546e7a;">// 如果是 Ok 变体，取出内部的值
</span><span style="color:#eeffff;">        </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">e</span><span style="color:#89ddff;">) =&gt; </span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">e</span><span style="color:#89ddff;">), </span><span style="font-style:italic;color:#546e7a;">// 如果是 Err 变体，提前返回 Err
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">    
</span><span style="color:#eeffff;">    </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">qty </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;"> cost_per_item </span><span style="color:#89ddff;">+</span><span style="color:#eeffff;"> processing_fee</span><span style="color:#89ddff;">)
</span><span style="color:#89ddff;">}
</span></pre>

<h5>impl error::Error</h5>
<p>需求：让 <code>main()</code> 函数可以处理任何实现了 <code>error:Error Trait</code> 的类型</p>
<p>背景：让用户输入一个数，必须是正整数，否则就报错，该数用 struct <code>PositiveNonzeroInteger</code>  wrap 起来</p>
<p>思路：必然要使用 Trait Object:  <code>fn main() -&gt; Result&lt;(), Box&lt;dyn error::Error&gt;&gt;</code></p>
<p>Tips :</p>
<ul>
<li>Rust 中，为了使一个类型能被用作错误类型，它必须要实现 <code>std::error::Error</code> trait。这个 trait 本身没有强制要求实现任何方法 :</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">error</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Error </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">CreationError </span><span style="color:#89ddff;">{}
</span></pre>

<ul>
<li>但唯一需要注意的 ： <code>std::error::Error</code> trait 依赖于 <code>std::fmt::Display</code> trait。这是因为错误类型需要能被友好地展示给用户，所以任何想实现 <code>Error</code> trait 的类型也必须实现 <code>Display</code> trait，来定义如何格式化和展示错误信息，</li>
<li>实现 <code>Display</code> trait 是实现自定义错误类型的常见做法，且是实现 <code>Error</code> trait 的前提:</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// This is required so that `CreationError` can implement `error::Error`.
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Display </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">CreationError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">fmt</span><span style="color:#89ddff;">(&amp;</span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">f</span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">mut </span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Formatter</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Result </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> description </span><span style="color:#89ddff;">= </span><span style="font-style:italic;color:#c792ea;">match </span><span style="color:#89ddff;">*</span><span style="font-style:italic;color:#ff5370;">self </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">            CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Negative </span><span style="color:#89ddff;">=&gt; "</span><span style="color:#c3e88d;">number is negative</span><span style="color:#89ddff;">",
</span><span style="color:#eeffff;">            CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Zero </span><span style="color:#89ddff;">=&gt; "</span><span style="color:#c3e88d;">number is zero</span><span style="color:#89ddff;">",
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">        f.</span><span style="color:#82aaff;">write_str</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">description</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<p>实现思路：现在思路很清晰了</p>
<ol>
<li>定义一个错误类型 struct : <code>CreationError</code></li>
<li>为这个 struct 实现 <code>error::Error</code> Trait</li>
<li>因为 <code>std::error::Error</code>  依赖于 <code>std::fmt::Display</code>, 顺便要把 <code>impl fmt::Display for CreationError</code>  实现了</li>
<li>使用 Trait Object 处理任何实现了 <code>error::Error</code> Trait  的 struct</li>
</ol>
<pre style="background-color:#263238;"><span style="color:#c792ea;">use </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">error</span><span style="color:#89ddff;">;
</span><span style="color:#c792ea;">use </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">;
</span><span style="color:#c792ea;">use </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">num</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">ParseIntError</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// TODO: update the return type of `main()` to make this compile.
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;()</span><span style="color:#eeffff;">, Box</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">dyn error</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Error</span><span style="color:#89ddff;">&gt;&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> user_input_ </span><span style="color:#89ddff;">= "</span><span style="color:#c3e88d;">42</span><span style="color:#89ddff;">";
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i64 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> user_input_.</span><span style="color:#82aaff;">parse</span><span style="color:#89ddff;">()?;
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">output=</span><span style="color:#eeffff;">{:?}</span><span style="color:#89ddff;">", </span><span style="color:#eeffff;">PositiveNonzeroInteger</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">)?);
</span><span style="color:#eeffff;">    </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(())
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// Don't change anything below this line.
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Debug</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">PositiveNonzeroInteger</span><span style="color:#89ddff;">(</span><span style="font-style:italic;color:#c792ea;">u64</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Debug</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">CreationError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    Negative</span><span style="color:#89ddff;">,  </span><span style="font-style:italic;color:#546e7a;">// 处理负数错误
</span><span style="color:#eeffff;">    Zero</span><span style="color:#89ddff;">,      </span><span style="font-style:italic;color:#546e7a;">// 处理 0 值错误
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">PositiveNonzeroInteger </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">new</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">value</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i64</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">PositiveNonzeroInteger, CreationError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> value </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">            x </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">&lt; </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Negative</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">            x </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Zero</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">            x </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PositiveNonzeroInteger</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x </span><span style="color:#89ddff;">as </span><span style="font-style:italic;color:#c792ea;">u64</span><span style="color:#89ddff;">)),
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// This is required so that `CreationError` can implement `error::Error`.
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Display </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">CreationError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">fmt</span><span style="color:#89ddff;">(&amp;</span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">f</span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">mut </span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Formatter</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Result </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> description </span><span style="color:#89ddff;">= </span><span style="font-style:italic;color:#c792ea;">match </span><span style="color:#89ddff;">*</span><span style="font-style:italic;color:#ff5370;">self </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">            CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Negative </span><span style="color:#89ddff;">=&gt; "</span><span style="color:#c3e88d;">number is negative</span><span style="color:#89ddff;">",
</span><span style="color:#eeffff;">            CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Zero </span><span style="color:#89ddff;">=&gt; "</span><span style="color:#c3e88d;">number is zero</span><span style="color:#89ddff;">",
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">        f.</span><span style="color:#82aaff;">write_str</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">description</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">error</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Error </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">CreationError </span><span style="color:#89ddff;">{}
</span></pre>

<p>最后一个问题：在 Pattern match 里，<code>match value {  x if x &lt; 0 =&gt; Err</code>  里第一个 <code>x</code> 是干嘛用的？</p>
<ul>
<li>这里的 <code>x if x &lt; 0</code> 可以解读为：将<code>value</code>绑定到<code>x</code>，然后检查<code>x</code>是否小于0。如果是，则执行对应的分支</li>
<li>在这个例子里，通配符 <code>_</code> 作为模式，也可以不绑定 <code>value</code> 到新变量，而是直接在 guard 中使用 <code>value</code> ：</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> value </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">_ </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> value </span><span style="color:#89ddff;">&lt; </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Negative</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">_ </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> value </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Zero</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">_ =&gt; </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PositiveNonzeroInteger</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">value </span><span style="color:#89ddff;">as </span><span style="font-style:italic;color:#c792ea;">u64</span><span style="color:#89ddff;">)),
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li>👆🏻 也是完全合理的</li>
</ul>
<h5>错误类型自动转换</h5>
<p>如上的 <code>&lt;(), Box&lt;dyn error::Error&gt;&gt;</code> 错误处理方式是 don't recommended 的： 不建议在库代码中使用像 <code>Box&lt;dyn error::Error&gt; </code>这样的包罗万象的错误类型，因为调用者可能希望根据错误内容做出决策，而不是将其打印出来或进一步传播</p>
<p>Error Type 自动转换 - 核心流程</p>
<ol>
<li><strong>自定义错误类型</strong>:</li>
</ol>
<ul>
<li><code>ParsePosNonzeroError</code>是一个枚举，它有 2 个 variants ，代表了两种可能的错误类型: <code>Creation(CreationError)</code>和<code>ParseInt(ParseIntError)</code>
<ul>
<li><code>CreationError</code> handle illegal input like 0, -99, -1 ..</li>
<li><code>ParseIntError</code> handle illegal input like "buzz buzz"</li>
</ul>
</li>
<li><code>CreationError</code>枚举，代表了在创建<code>PositiveNonzeroInteger</code>时可能会出现的错误:
<ul>
<li>Negative</li>
<li>Zero</li>
</ul>
</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">ParsePosNonzeroError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    Creation</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">), { </span><span style="font-style:italic;color:#546e7a;">// handle illegal input like 0, -99, -1 ..
</span><span style="color:#eeffff;">        Negative</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Zero
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    ParseInt</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">ParseIntError</span><span style="color:#89ddff;">), </span><span style="font-style:italic;color:#546e7a;">// handle illegal input like "buzz buzz" 
</span><span style="color:#89ddff;">}
</span></pre>

<ol start="2">
<li><strong>实现 From trait</strong>:</li>
</ol>
<ul>
<li>对于<code>ParsePosNonzeroError</code>来说，其包含的 2 种错误：<code>ParseIntError</code>（当解析字符串到数字时）和 <code>CreationError</code>（当数字是零或者负数时），这两种错误都需要被转换为 <code>ParsePosNonzeroError</code> 类型，以便返回给函数调用者</li>
<li>为什么要让两种错误可以被自动地转换成<code>ParsePosNonzeroError</code> 呢？
<ul>
<li>为了简化错误处理和提供统一的错误接口</li>
</ul>
</li>
<li>如何实现 ? —— 为 2 种错误实现 <code>From</code> Trait
<ul>
<li><code>From</code> trait是用于类型之间的转换的。当你为一个类型实现了<code>From</code> trait，这个类型就可以被自动地转换到目标类型。在这个情况下，实现了<code>From&lt;CreationError&gt; for ParsePosNonzeroError</code> 和 <code>From&lt;ParseIntError&gt; for ParsePosNonzeroError</code>，意味着<code>CreationError</code>和<code>ParseIntError</code>类型的值可以被自动转换成<code>ParsePosNonzeroError</code>类型</li>
<li>具体来说，当你在函数中使用 <code>?</code> 操作符时，如果发生了错误，Rust会查找是否存在从实际错误类型到函数返回错误类型的 <code>From</code> trait实现。如果存在，Rust会自动调用这个实现来转换错误类型。所以，在这个例子中，通过实现 <code>From&lt;CreationError&gt; for ParsePosNonzeroError</code> 和 <code>From&lt;ParseIntError&gt; for ParsePosNonzeroError</code>，你可以在函数中方便地使用 <code>?</code> 来处理错误，并将它们转换为 <code>ParsePosNonzeroError</code> 类型</li>
</ul>
</li>
</ul>
<ol start="3">
<li><strong>错误转换与传播</strong>:</li>
</ol>
<ul>
<li>在<code>parse_pos_nonzero</code>函数中，字符串解析的错误（<code>ParseIntError</code>）和创建<code>PositiveNonzeroInteger</code>的错误（<code>CreationError</code>）都通过<code>.map_err(ParsePosNonzeroError::from)</code>的方式被转换成<code>ParsePosNonzeroError</code></li>
<li>使用<code>?</code>操作符，如果<code>Result</code>是<code>Err</code>，函数会提前返回错误；如果是<code>Ok</code>，则继续执行。</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#c792ea;">use </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">num</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">ParseIntError</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// This is a custom error type that we will be using in `parse_pos_nonzero()`.
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Debug</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">ParsePosNonzeroError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    Creation</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">), </span><span style="font-style:italic;color:#546e7a;">// handle illegal input like 0, -99, -1 ..
</span><span style="color:#eeffff;">    ParseInt</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">ParseIntError</span><span style="color:#89ddff;">), </span><span style="font-style:italic;color:#546e7a;">// handle illegal input like "buzz buzz" 
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// CreationError 转换-&gt; ParsePosNonzeroError
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">From</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">&gt; </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">ParsePosNonzeroError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">from</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">err</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> CreationError</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> ParsePosNonzeroError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        ParsePosNonzeroError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Creation</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">err</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// ParseIntError 转换-&gt; ParsePosNonzeroError
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">From</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">ParseIntError</span><span style="color:#89ddff;">&gt; </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">ParsePosNonzeroError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">from</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">err</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> ParseIntError</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> ParsePosNonzeroError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        ParsePosNonzeroError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">ParseInt</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">err</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">parse_pos_nonzero</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">s</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">PositiveNonzeroInteger, ParsePosNonzeroError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// let x: i64 = s.parse()?;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i64 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> s.</span><span style="color:#82aaff;">parse</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">map_err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">ParsePosNonzeroError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">)?;
</span><span style="color:#eeffff;">    PositiveNonzeroInteger</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">map_err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">ParsePosNonzeroError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">)
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// Don't change anything below this line.
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Debug</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">PositiveNonzeroInteger</span><span style="color:#89ddff;">(</span><span style="font-style:italic;color:#c792ea;">u64</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Debug</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">CreationError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    Negative</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">    Zero</span><span style="color:#89ddff;">,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">PositiveNonzeroInteger </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">new</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">value</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i64</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">PositiveNonzeroInteger, CreationError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> value </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">            x </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">&lt; </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Negative</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">            x </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">CreationError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Zero</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">            x </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PositiveNonzeroInteger</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x </span><span style="color:#89ddff;">as </span><span style="font-style:italic;color:#c792ea;">u64</span><span style="color:#89ddff;">)),
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<h4>generics</h4>
<p><code>练习 1 :</code> emmm</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> shopping_list</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;&amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">&gt; = </span><span style="color:#ffcb6b;">Vec</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    shopping_list.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">milk</span><span style="color:#89ddff;">");
</span><span style="color:#89ddff;">}
</span></pre>

<p><code>练习 2</code> :</p>
<ul>
<li>注意 <code>&lt;T&gt;</code>  的位置</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Wrapper</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">T</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    value</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> T,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">T</span><span style="color:#89ddff;">&gt; </span><span style="color:#eeffff;">Wrapper</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">T</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">new</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">value</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> T</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">Self </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        Wrapper </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> value </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<h4>Trait</h4>
<p>为 <code>Vec&lt;String&gt;</code> 实现往屁股后面追加一个 "Bar",  例如：</p>
<ul>
<li>调用前： <code>vec!["Foo"]</code></li>
<li>调用后： <code>vec!["Foo", "Bar"]</code></li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">trait </span><span style="color:#eeffff;">AppendBar </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">append_bar</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">self</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">Self</span><span style="color:#89ddff;">;
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">AppendBar </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">append_bar</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">self</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">Self </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Bar</span><span style="color:#89ddff;">")); </span><span style="font-style:italic;color:#546e7a;">// 向向量末尾追加一个新的String，内容为"Bar"
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#ff5370;">self </span><span style="font-style:italic;color:#546e7a;">// 返回修改后的向量
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<p>观察到： trait 中 <code>fn append_bar(self)</code> 和 impl 里 <code>fn append_bar(mut self)</code> 并不完全一致： impl 里多了 <code>mut</code> :</p>
<ul>
<li>这是完全允许的，因为 <code>mut</code> 关键字只影响函数体内部对 <code>self</code> 的可变性</li>
<li>当我们在 trait 定义中声明 <code>fn append_bar(self) -&gt; Self;</code> 时，我们仅仅是在表明这个方法会取得 <code>self</code> 的所有权，并且没有指定 <code>self</code> 是否是可变的</li>
<li>在实现 trait 的时候，我们可以决定是否需要 <code>self</code> 是可变的 :
<ul>
<li>如果我们需要修改 <code>self</code>，那么我们在 impl 时可以加上 <code>mut</code> 来获得 <code>self</code> 的可变引用</li>
<li>这样的设计给予了我们很大的灵活性，允许我们在不同的实现中选择是否要 <code>mut self</code></li>
</ul>
</li>
</ul>
<h5>Trait bounds: impl xxTrait</h5>
<p>背景：比较 2 个软件(software) 的 license 是否一致</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">compare_license_types</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">sf1</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> impl Licensed, </span><span style="color:#f78c6c;">sf2</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> impl Licensed</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">bool </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    sf1.</span><span style="color:#82aaff;">licensing_info</span><span style="color:#89ddff;">() ==</span><span style="color:#eeffff;"> sf2.</span><span style="color:#82aaff;">licensing_info</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span></pre>

<p>这是 Trait bounds 语法，用来表明这个函数可以接受任何实现了 <code>Licensed</code> trait 的类型作为参数</p>
<p>这个函数签名中，<code>sf1</code> 和 <code>sf2</code> 需要实现 <code>Licensed</code> trait  ，函数体中，我们调用了这两个对象的 <code>licensing_info</code> 方法（由于他们都实现了 <code>Licensed</code> trait，所以我们可以确保这个方法是存在的），然后比较了这两个字符串是否相等，最后返回了这个比较的结果</p>
<hr>
<p>Trait bound - 2 来袭 !!
现在我们要求： 函数 <code>some_func</code> 能够接受任何<strong>同时实现了</strong> <code>SomeTrait</code> 和 <code>OtherTrait</code> 的类型作为参数：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">some_func</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">item</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> impl SomeTrait + OtherTrait</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">bool </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    item.</span><span style="color:#82aaff;">some_function</span><span style="color:#89ddff;">() &amp;&amp;</span><span style="color:#eeffff;"> item.</span><span style="color:#82aaff;">other_function</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">或者：
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">some_func</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">T</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> SomeTrait </span><span style="color:#89ddff;">+</span><span style="color:#eeffff;"> OtherTrait</span><span style="color:#89ddff;">&gt;(</span><span style="color:#f78c6c;">item</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> T</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">bool </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    item.</span><span style="color:#82aaff;">some_function</span><span style="color:#89ddff;">() &amp;&amp;</span><span style="color:#eeffff;"> item.</span><span style="color:#82aaff;">other_function</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span></pre>

<p>这 2 种写法都是可以的。</p>
<ul>
<li>some_func<code>(item: impl SomeTrait + OtherTrait)</code></li>
<li>some_func<code>&lt;T: SomeTrait + OtherTrait&gt;(item: T)</code></li>
</ul>
<h4>Exercise 3 (泛型+Trait)</h4>
<p>背景：打印 2 种格式的成绩单，分别支持 numerically (e.g. 1.0 -&gt; 5.5) 和  alphabetical grades (A+ -&gt; F-)</p>
<p>思路：泛型</p>
<p>现有代码：</p>
<ul>
<li>ReportCard 成绩单，可以看到目前的成绩只支持 <code>f32</code></li>
<li>当 grade 改成泛型后，必须确保类型能使用 format 输出，即支持 <code>std::fmt::Display</code> Trait</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">ReportCard </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="color:#eeffff;">grade</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">f32</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="color:#eeffff;">student_name</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> String,
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="color:#eeffff;">student_age</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl </span><span style="color:#eeffff;">ReportCard </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">print</span><span style="color:#89ddff;">(&amp;</span><span style="color:#f78c6c;">self</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        format!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;"> (</span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;">) - achieved a grade of </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">",
</span><span style="color:#eeffff;">            </span><span style="color:#89ddff;">&amp;</span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.student_name</span><span style="color:#89ddff;">, &amp;</span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.student_age</span><span style="color:#89ddff;">, &amp;</span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.grade</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<p>实现代码：</p>
<pre style="background-color:#263238;"><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">ReportCard</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">T</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="color:#eeffff;">grade</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> T,
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="color:#eeffff;">student_name</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> String,
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="color:#eeffff;">student_age</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#eeffff;">,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">impl</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">T</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">fmt</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Display</span><span style="color:#89ddff;">&gt; </span><span style="color:#eeffff;">ReportCard</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">T</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">print</span><span style="color:#89ddff;">(&amp;</span><span style="color:#f78c6c;">self</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        format!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;"> (</span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;">) - achieved a grade of </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">",
</span><span style="color:#eeffff;">            </span><span style="color:#89ddff;">&amp;</span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.student_name</span><span style="color:#89ddff;">, &amp;</span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.student_age</span><span style="color:#89ddff;">, &amp;</span><span style="font-style:italic;color:#ff5370;">self</span><span style="color:#eeffff;">.grade</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<h4>lifetime</h4>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> 待解题代码
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">longest</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">x</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">y</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt; &amp;</span><span style="font-style:italic;color:#c792ea;">str </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> x.</span><span style="color:#82aaff;">len</span><span style="color:#89ddff;">() &gt;</span><span style="color:#eeffff;"> y.</span><span style="color:#82aaff;">len</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        x
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">} </span><span style="font-style:italic;color:#c792ea;">else </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        y
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> Solution ✅
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">longest</span><span style="color:#89ddff;">&lt;</span><span style="color:#c792ea;">'a</span><span style="color:#89ddff;">&gt;(</span><span style="color:#f78c6c;">x </span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">y</span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt; &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str </span><span style="color:#89ddff;">{
</span></pre>

<p>在 <code>longest</code> 参数中，引入了生命周期 <code>'a</code>，并将它应用到参数 <code>x</code> 和 <code>y</code> 以及返回值类型 <code>&amp;'a str</code> 上。这告诉编译器，<code>result</code> 的生命周期与输入参数的生命周期一致，这样就不会出现生命周期不匹配的错误了</p>
<hr>
<p>场景：仍是上面的 longest 函数定义，这次我们在调用的时候做了手脚：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">longest</span><span style="color:#89ddff;">&lt;</span><span style="color:#c792ea;">'a</span><span style="color:#89ddff;">&gt;(</span><span style="color:#f78c6c;">x </span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">y</span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt; &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str </span><span style="color:#89ddff;">{ ... } 
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> s1 </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">long string is long</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> result</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> s2 </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">xyz</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">        res </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">longest</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">s1.</span><span style="color:#82aaff;">as_str</span><span style="color:#89ddff;">(),</span><span style="color:#eeffff;"> s2.</span><span style="color:#82aaff;">as_str</span><span style="color:#89ddff;">());
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">The longest string is '</span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;">'</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> result</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">res </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">longest</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">s1.</span><span style="color:#82aaff;">as_str</span><span style="color:#89ddff;">(),</span><span style="color:#eeffff;"> s2.</span><span style="color:#82aaff;">as_str</span><span style="color:#89ddff;">());</span><span style="color:#eeffff;">  ❌  
</span><span style="color:#eeffff;">                           </span><span style="color:#89ddff;">^^^^^^^^</span><span style="color:#eeffff;"> borrowed value does not live long enough
</span></pre>

<p>错误分析：尝试在 <code>s2</code> 的生命周期结束后继续使用 <code>res</code> ，❌ ，不能让 <code>result</code> 引用 <code>string2</code>，因为它的生命周期已经结束了</p>
<p>这道题无法通过修改 longest 的函数定义来解决，因为生命周期标注只是一个标注，它不改变任何实际的生命周期</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// Solution ✅
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> s1 </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">long string is long</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> s2 </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">xyz</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> res </span><span style="color:#89ddff;">= </span><span style="color:#82aaff;">longest</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">s1.</span><span style="color:#82aaff;">as_str</span><span style="color:#89ddff;">(),</span><span style="color:#eeffff;"> s2.</span><span style="color:#82aaff;">as_str</span><span style="color:#89ddff;">());
</span></pre>

<hr>
<p>结构体的生命周期：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// ❌ 代码：
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Book </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    author</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">    title</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">,
</span><span style="color:#89ddff;">}
</span></pre>

<p>在 <code>struct Book</code> 的定义中，我们引入了生命周期参数 <code>'a</code>，并将其应用于 <code>author</code> 和 <code>title</code> 字段，以指示这两个字段的引用与结构体的生命周期相绑定。</p>
<p>在 <code>main</code> 函数中，我们创建了 <code>name</code> 和 <code>title</code> 字符串，然后使用它们来初始化 <code>Book</code> 结构体的字段。由于 <code>Book</code> 结构体的生命周期参数是 <code>'a</code>，因此 <code>author</code> 和 <code>title</code> 字段的引用必须与 <code>'a</code> 生命周期相匹配。这确保了在 <code>Book</code> 结构体中存储的引用在其所有权者（<code>name</code> 和 <code>title</code>）有效的情况下才能使用</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// ✅  Solution:
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">Book</span><span style="color:#89ddff;">&lt;</span><span style="color:#c792ea;">'a</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    author</span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">    title</span><span style="color:#89ddff;">: &amp;</span><span style="color:#c792ea;">'a </span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> name </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Jill Smith</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> title </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Fish Flying</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> book </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> Book </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> author</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">name</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> title</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">title </span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;"> by </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> book.title</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> book.author</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<h4>Tests</h4>
<p>常用的 assert :</p>
<ul>
<li><code>assert!</code>,&nbsp;<code>assert_eq!</code>,&nbsp;<code>assert_ne!</code>, 它们会在所有模式下运行</li>
<li><code>debug_assert!</code>,&nbsp;<code>debug_assert_eq!</code>,&nbsp;<code>debug_assert_ne!</code>, 它们只会在&nbsp;<code>Debug</code>&nbsp;模式下运行</li>
</ul>
<h5>assert_eq</h5>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> constrain </span><span style="color:#f78c6c;">2 </span><span style="color:#89ddff;">==</span><span style="color:#eeffff;"> second.
</span><span style="color:#eeffff;">assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> second</span><span style="color:#89ddff;">, "</span><span style="color:#c3e88d;">This is not the 2nd number in the tuple!</span><span style="color:#89ddff;">")
</span></pre>

<h5>should_panic</h5>
<p>写了几个必须 <code>panic</code> 的错误测试用例，如何测试？</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">    </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">correct_width_and_height</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> rect </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Rectangle</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">20</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">        assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">rect.width</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">); </span><span style="font-style:italic;color:#546e7a;">// check width
</span><span style="color:#eeffff;">        assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">rect.height</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">20</span><span style="color:#89ddff;">); </span><span style="font-style:italic;color:#546e7a;">// check height
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">should_panic</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">negative_width</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> _rect </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Rectangle</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(-</span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">should_panic</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">negative_height</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> _rect </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Rectangle</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">, -</span><span style="color:#f78c6c;">10</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">}
</span></pre>

<ul>
<li>如上代码 <code>#[should_panic]</code> , 在传入长度、宽度为 negative  的 rectangle 时，函数应该 panic，测试通过也就说明确实 panic 了。</li>
</ul>
<h4>Iterator</h4>
<ul>
<li><code>into_iter</code>&nbsp;会<strong>夺走所有权</strong></li>
<li><code>iter</code>&nbsp;是借用</li>
<li><code>iter_mut</code>&nbsp;是可变借用</li>
</ul>
<hr>
<h5>iter vs. into_iter :</h5>
<ul>
<li>如下 2 个 <code>main()</code> 都是正确的, 区别在 2 个地方：
<ul>
<li><code>fruits.into_iter();</code>  and    <code>fruits.iter();</code></li>
<li><code>Some("banana"))</code>   and    <code>Some(&amp;"banana"))</code></li>
</ul>
</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> fruits </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">["</span><span style="color:#c3e88d;">banana</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">peach</span><span style="color:#89ddff;">",];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> iter_fruits </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> fruits.</span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">iter_fruits.</span><span style="color:#82aaff;">next</span><span style="color:#89ddff;">(), </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">banana</span><span style="color:#89ddff;">"));
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">iter_fruits.</span><span style="color:#82aaff;">next</span><span style="color:#89ddff;">(), </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">peach</span><span style="color:#89ddff;">"));    
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">iter_fruits.</span><span style="color:#82aaff;">next</span><span style="color:#89ddff;">(), </span><span style="color:#ffcb6b;">None</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span><span style="font-style:italic;color:#546e7a;">// --------------------------------  //
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> fruits </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">["</span><span style="color:#c3e88d;">banana</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">peach</span><span style="color:#89ddff;">",];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> iter_fruits </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> fruits.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">iter_fruits.</span><span style="color:#82aaff;">next</span><span style="color:#89ddff;">(), </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(&amp;"</span><span style="color:#c3e88d;">banana</span><span style="color:#89ddff;">"));
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">iter_fruits.</span><span style="color:#82aaff;">next</span><span style="color:#89ddff;">(), </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(&amp;"</span><span style="color:#c3e88d;">peach</span><span style="color:#89ddff;">"));    
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">iter_fruits.</span><span style="color:#82aaff;">next</span><span style="color:#89ddff;">(), </span><span style="color:#ffcb6b;">None</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>fruits</code> 实现了<code>IntoIterator</code>&nbsp;Trait，因此可以通过&nbsp;<code>.iter()</code> / &nbsp;&nbsp;<code>.into_iter()</code> 将其转换为迭代器</li>
<li><code>"banana"</code> 是 String lateral，其类型是 <code>&amp;str</code> ;</li>
<li><code>Some("banana")</code> 的类型是 <code>Option&lt;&amp;&amp;str&gt;</code> ;
<ul>
<li>在 <code>.iter()</code> 的实现中，每个迭代器元素都是原来 <code>ele</code> 的 reference</li>
</ul>
</li>
<li><code>Some(&amp;"banana")</code> 的类型是 <code>Option&lt;&amp;str&gt;</code> ;
<ul>
<li>在 <code>.into_iter()</code> 实现中，每个迭代器元素都是原来 <code>ele</code> itself</li>
</ul>
</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">impl</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">I</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Iterator</span><span style="color:#89ddff;">&gt;</span><span style="color:#eeffff;"> IntoIterator </span><span style="color:#c792ea;">for </span><span style="color:#eeffff;">I </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">type </span><span style="color:#eeffff;">Item </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">I</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Item</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">type </span><span style="color:#eeffff;">IntoIter </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> I</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">inline</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">self</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> I </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#ff5370;">self     
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">} 
</span><span style="color:#89ddff;">}
</span></pre>

<h5>map</h5>
<ul>
<li>实现一系列首字母大写的函数，比如：
<ul>
<li><code>"hello" </code>-&gt;<code> "Hello"</code></li>
<li><code>["hello", "world"]</code>  -&gt;  <code>["Hello", "World"]</code></li>
<li><code>["hello", " ", "world"]</code>  -&gt;  <code>"Hello World"</code></li>
</ul>
</li>
<li>根据上述需求，我们需要实现 3 个函数：
<ul>
<li>
<ol>
<li><code>capitalize_first</code> —— 将 "hello" 首字母大写</li>
</ol>
</li>
<li>
<ol start="2">
<li><code>capitalize_words_vector</code> —— 利用 <code>.map()</code> ，将 vec 里的所有 word 都 apply <code>capitalize_first</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><code>capitalize_words_string</code> , 利用 <code>.join</code> 将 vec 里的元素 concat 成 String</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>具体实现：Part-1 ， Part-2， Part-3：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// Part - 1
</span><span style="font-style:italic;color:#546e7a;">// "hello" -&gt; "Hello"
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">capitalize_first</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">input</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> c </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> input.</span><span style="color:#82aaff;">chars</span><span style="color:#89ddff;">(); </span><span style="font-style:italic;color:#546e7a;">// 创建字符迭代器 Chars(['h','e','l','l','o'])
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> c.</span><span style="color:#82aaff;">next</span><span style="color:#89ddff;">() {  </span><span style="font-style:italic;color:#546e7a;">// 获取迭代器的第一个字符
</span><span style="color:#eeffff;">        </span><span style="color:#ffcb6b;">None </span><span style="color:#89ddff;">=&gt; </span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(),   </span><span style="font-style:italic;color:#546e7a;">// 如果没有字符，则返回空字符串
</span><span style="color:#eeffff;">        </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">first</span><span style="color:#89ddff;">) =&gt; {
</span><span style="color:#eeffff;">            </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> capitalized </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> first.</span><span style="color:#82aaff;">to_uppercase</span><span style="color:#89ddff;">(); </span><span style="font-style:italic;color:#546e7a;">// 将第一个字符大写
</span><span style="color:#eeffff;">            capitalized.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">() +</span><span style="color:#eeffff;"> c.</span><span style="color:#82aaff;">as_str</span><span style="color:#89ddff;">() </span><span style="font-style:italic;color:#546e7a;">// 添加剩余字符并转换为字符串
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>&amp;str.chars()</code> 方法返回一个包含 <code>char</code> 值的迭代器</li>
<li>这里 only call   <code>c.next()</code>  once ，所以是获取了首字母（第一个字母）</li>
<li><code>c.as_str()</code> 返回了一个字符串切片，指向了迭代器 <code>c</code> 中剩余未处理的字符部分。这个切片没有进行额外的内存分配或者字符串复制，而只是提供了对原始字符串中字符的引用</li>
<li><code>capitalized.to_string() + c.as_str()</code> ：
<ul>
<li>一个<code>String</code>和一个<code>&amp;str</code>相加时，Rust会自动将<code>&amp;str</code>转换为<code>String</code>，然后执行拼接操作。因为<code>String</code>实现了<code>Add</code> trait，其中有一个与<code>&amp;str</code>相加的实现，允许你直相加</li>
</ul>
</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// Part - 2
</span><span style="font-style:italic;color:#546e7a;">// ["hello", "world"] -&gt; ["Hello", "World"]
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">capitalize_words_vector</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">words</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">[</span><span style="color:#89ddff;">&amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">]</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String</span><span style="color:#89ddff;">&gt;{
</span><span style="color:#eeffff;">    words.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">() </span><span style="font-style:italic;color:#546e7a;">// 创建字符串切片的迭代器
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">map</span><span style="color:#89ddff;">(|&amp;</span><span style="color:#f78c6c;">word</span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">capitalize_first</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">word</span><span style="color:#89ddff;">)) </span><span style="font-style:italic;color:#546e7a;">//处理每个 word
</span><span style="color:#eeffff;">        .collect</span><span style="color:#89ddff;">::&lt;</span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String</span><span style="color:#89ddff;">&gt;&gt;() </span><span style="font-style:italic;color:#546e7a;">// 收集处理后的结果并返回为向量
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#546e7a;">// .collect() 不写类型也可以
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">test_iterate_string_vec</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> words </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">["</span><span style="color:#c3e88d;">hello</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">world</span><span style="color:#89ddff;">"];
</span><span style="color:#eeffff;">        assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#82aaff;">capitalize_words_vector</span><span style="color:#89ddff;">(&amp;</span><span style="color:#eeffff;">words</span><span style="color:#89ddff;">), ["</span><span style="color:#c3e88d;">Hello</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">World</span><span style="color:#89ddff;">"]);
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li>本部分代码处理 <code>["hello", "world"] -&gt; ["Hello", "World"]</code></li>
<li>参数部分： <code>&amp;[&amp;str]</code> 代表对<code>words</code> 切片的引用，而不是移动 <code>words</code> 到函数中。这可以帮助读者理解代码的行为</li>
<li><code>.collect() </code> 也可以不写具体类型让他自动推断为函数返回值  <code>Vec&lt;String&gt;</code></li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// ["hello", " ", "world"] -&gt; "Hello World"
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">capitalize_words_string</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">words</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">[</span><span style="color:#89ddff;">&amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#eeffff;">]</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> String </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    words.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">() </span><span style="font-style:italic;color:#546e7a;">// 创建字符串切片的迭代器
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">map</span><span style="color:#89ddff;">(|&amp;</span><span style="color:#f78c6c;">word</span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">capitalize_first</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">word</span><span style="color:#89ddff;">)) </span><span style="font-style:italic;color:#546e7a;">// map 处理每个单词
</span><span style="color:#eeffff;">        .collect</span><span style="color:#89ddff;">::&lt;</span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;_&gt;&gt;() </span><span style="font-style:italic;color:#546e7a;">// 收集处理后的结果并返回为向量
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">join</span><span style="color:#89ddff;">("") 
</span></pre>

<ul>
<li><code>join</code> 将 Vec 转化为 String</li>
</ul>
<hr>
<h5>bigger exercise</h5>
<ul>
<li>背景：一个整除问题，要对 <code>除 0</code>  及 <code>无法整除</code> define Error，然后用迭代器和 map 实现数组的计算</li>
</ul>
<p>错误设计：</p>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Debug</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Eq</span><span style="color:#89ddff;">)]
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">DivisionError </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    NotDivisible</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">NotDivisibleError</span><span style="color:#89ddff;">),  --------|
</span><span style="color:#eeffff;">    DivideByZero</span><span style="color:#89ddff;">,                             |
</span><span style="color:#89ddff;">}                                             |
</span><span style="color:#eeffff;">                                              </span><span style="color:#89ddff;">|
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Debug</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Eq</span><span style="color:#89ddff;">)]               |
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">NotDivisibleError </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;">    &lt;-----------|  
</span><span style="color:#eeffff;">    dividend</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">,
</span><span style="color:#eeffff;">    divisor</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">,            </span><span style="color:#89ddff;">}
</span></pre>

<p><code>divide</code> 除法函数设计 ：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// Calculate `a` divided by `b` if `a` is evenly divisible by `b`.
</span><span style="font-style:italic;color:#546e7a;">// Otherwise, return a suitable error.
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">divide</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">a</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">b</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">, DivisionError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> b </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">{ </span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">DivisionError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">DivideByZero</span><span style="color:#89ddff;">) }
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> a </span><span style="color:#89ddff;">%</span><span style="color:#eeffff;"> b </span><span style="color:#89ddff;">== </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">a </span><span style="color:#89ddff;">/</span><span style="color:#eeffff;"> b</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}</span><span style="font-style:italic;color:#c792ea;">else</span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">DivisionError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">NotDivisible</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">NotDivisibleError</span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">            dividend</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> a</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">            divisor</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> b</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}))
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li>注意，NotDivisibleError 是个 struct，所以构建这个错误时需要传递相应的参数。</li>
</ul>
<p>2 个 list 的 <code>.map()</code> 处理：</p>
<ul>
<li>返回值不同:  <code>Ok([1, 11, 20, 100])</code>    and   <code>[Ok(1), Ok(11), Ok(20), Ok(100)]</code></li>
<li>看到 variant 类型 notation 对于 <code>.collect()</code> 类型推导的影响</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// Complete the function and return a value of the correct type so the test
</span><span style="font-style:italic;color:#546e7a;">// passes.
</span><span style="font-style:italic;color:#546e7a;">// Desired output:   Ok([1, 11, 20, 100])
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">result_with_list</span><span style="color:#89ddff;">() -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">&gt;</span><span style="color:#eeffff;">, DivisionError</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> numbers </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">7</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">77</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">140</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">700</span><span style="color:#89ddff;">];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> division_results</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">&gt;</span><span style="color:#eeffff;">, DivisionError</span><span style="color:#89ddff;">&gt; =</span><span style="color:#eeffff;"> numbers
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">map</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">n</span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">divide</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">n</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">7</span><span style="color:#89ddff;">))
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    division_results
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// Complete the function and return a value of the correct type so the test
</span><span style="font-style:italic;color:#546e7a;">// passes.
</span><span style="font-style:italic;color:#546e7a;">// Desired output:   [Ok(1), Ok(11), Ok(20), Ok(100)]
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">list_of_results</span><span style="color:#89ddff;">() -&gt; </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#eeffff;">, DivisionError</span><span style="color:#89ddff;">&gt;&gt; {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> numbers </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">7</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">77</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">140</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">700</span><span style="color:#89ddff;">];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> division_results </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> numbers
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">map</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">n</span><span style="color:#89ddff;">| </span><span style="color:#82aaff;">divide</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">n</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">7</span><span style="color:#89ddff;">))
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    division_results
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">test_result_with_list</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">	assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">format!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{:?}</span><span style="color:#89ddff;">", </span><span style="color:#82aaff;">result_with_list</span><span style="color:#89ddff;">()), "</span><span style="color:#c3e88d;">Ok([1, 11, 20, 100])</span><span style="color:#89ddff;">");
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">test_list_of_results</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">	assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">format!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{:?}</span><span style="color:#89ddff;">", </span><span style="color:#82aaff;">list_of_results</span><span style="color:#89ddff;">()),"</span><span style="color:#c3e88d;">[Ok(1), Ok(11), Ok(20), Ok(100)]</span><span style="color:#89ddff;">");
</span><span style="color:#89ddff;">}
</span></pre>

<h5>阶乘 factorial</h5>
<p>计算 num 的阶乘 （注意，num = 0 时，阶乘为 1 ）：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// ✅ Solution 
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">factorial</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">num</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u64</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">u64 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">..=</span><span style="color:#eeffff;">num</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">fold</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">, |</span><span style="color:#f78c6c;">acc</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">x</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">acc </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">)
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>(1..=num)</code> 和 <code>(1..num+1)</code> 是等价的</li>
</ul>
<p><a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html" rel="noopener noreferrer">fold 函数:</a></p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">fold</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">B, F</span><span style="color:#89ddff;">&gt;(</span><span style="color:#f78c6c;">self</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">init</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> B, </span><span style="color:#f78c6c;">f</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> F</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> B
</span><span style="color:#eeffff;">   </span><span style="color:#c792ea;">where </span><span style="font-style:italic;color:#c792ea;">Self</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Sized,
</span><span style="color:#eeffff;">		 F</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> FnMut</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">B, </span><span style="font-style:italic;color:#c792ea;">Self</span><span style="font-style:italic;color:#89ddff;">::</span><span style="color:#eeffff;">Item</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;"> -&gt; B </span><span style="color:#89ddff;">{ ... }
</span></pre>

<p><code>fold</code> 方法接受两个参数：</p>
<ol>
<li><code>init</code>：初始累加器的值，是累加过程的起点</li>
<li><code>f</code>：一个闭包，该闭包接受两个参数，① 当前的累加器值，② 迭代器产生的下一个元素，闭包返回一个新的累加器值</li>
</ol>
<p><code>fold</code> 方法的工作流程如下：</p>
<ol>
<li>初始化累加器为 <code>init</code></li>
<li>对于迭代器中的每个元素，调用闭包 <code>f</code>，并将当前累加器值和元素作为参数传递给闭包</li>
<li>闭包返回一个新的累加器值，它将在下一次迭代中被用作当前的累加器值</li>
<li>迭代继续，直到遍历完所有元素。</li>
<li>最后，<code>fold</code> 方法返回最终的累加器值</li>
</ol>
<p>下面是一个简单的示例，演示了如何使用 <code>fold</code> 计算一个数字向量的总和：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> numbers </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">3</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">4</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">5</span><span style="color:#89ddff;">]; 
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> sum </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> numbers.</span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">fold</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">, |</span><span style="color:#f78c6c;">acc</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">x</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">acc </span><span style="color:#89ddff;">+</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">);
</span></pre>

<h5>count iterator</h5>
<p>现在有这样一个 Table，里面存放着我们的解题的 progress , 如下:</p>
<ul>
<li>题目有 3 种状态，完成(Complete)，解题中(Some) 和 未解答(None)</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#eeffff;">map.</span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">variables1</span><span style="color:#89ddff;">"),</span><span style="color:#eeffff;"> Complete</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">map.</span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">functions1</span><span style="color:#89ddff;">"),</span><span style="color:#eeffff;"> Complete</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">map.</span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">hashmap1</span><span style="color:#89ddff;">"),</span><span style="color:#eeffff;"> Complete</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">map.</span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">arc1</span><span style="color:#89ddff;">"), </span><span style="color:#ffcb6b;">Some</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">map.</span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">as_ref_mut</span><span style="color:#89ddff;">"), </span><span style="color:#ffcb6b;">None</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">map.</span><span style="color:#82aaff;">insert</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">from_str</span><span style="color:#89ddff;">"), </span><span style="color:#ffcb6b;">None</span><span style="color:#89ddff;">);
</span></pre>

<p>现在的需求是，写几个函数，要根据<strong>状态</strong>做筛选然后计算个数，比如 Complete 的题目有几个, Some 状态的题目有几个 ...</p>
<p>思路：<strong>filter</strong></p>
<p>Task-1 : 给一个 <code>&amp;HashMap&lt;String, Progress&gt;</code> ，计算处在某状态的题目数</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">count_iterator</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">maps</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">HashMap</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String, Progress</span><span style="color:#89ddff;">&gt;</span><span style="color:#eeffff;">, </span><span style="color:#f78c6c;">prog</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Progress</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">usize </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// maps is a hashmap with String keys and Progress values.
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// maps = { "variables1": Complete, "from_str": None, ... }
</span><span style="color:#eeffff;">    maps.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">filter</span><span style="color:#89ddff;">(|(</span><span style="color:#eeffff;">_</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> &amp;</span><span style="color:#f78c6c;">item</span><span style="color:#89ddff;">)| </span><span style="color:#eeffff;">item </span><span style="color:#89ddff;">==</span><span style="color:#eeffff;"> prog</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">count</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>HashMap&lt;String, Progress&gt;</code> 里的 key 和 value 可以使用 <code>tuple</code> 解包 deconstruct</li>
<li>注意，这里直接对 maps 这个 HashMap 调用了 <code>iter()</code> ， 因为<code>HashMap</code> 是一个实现了 <code>IntoIterator</code> trait
<ul>
<li>solidity 里的 mapping 无法迭代，不要带跑偏了印象流</li>
</ul>
</li>
</ul>
<p>filter 详解：</p>
<pre style="background-color:#263238;"><span style="color:#eeffff;">vec.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">filter</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">closure_variable</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">closure_condition</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// 例子:
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> week_days </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">["</span><span style="color:#c3e88d;">Monday</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">Tuesday</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">Wednesday</span><span style="color:#89ddff;">", ..]
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> filtered_week_days</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;_&gt; =</span><span style="color:#eeffff;"> week_days
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">filter</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">days</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">days.</span><span style="color:#82aaff;">len</span><span style="color:#89ddff;">() &lt; </span><span style="color:#f78c6c;">8</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span></pre>

<hr>
<p>Task-2 : 给一组 <code>&amp;HashMap&lt;String, Progress&gt;</code> 的数组切片，计算所有处在某状态的题目数</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">cc</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">collection</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">[HashMap</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">String, Progress</span><span style="color:#89ddff;">&gt;</span><span style="color:#eeffff;">], </span><span style="color:#f78c6c;">prog</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> Progress</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">usize </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// collection is a slice of hashmaps.
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">// collection = [{ "variables1": Complete, "from_str": None, ... },
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#546e7a;">//     { "variables2": Complete, ... }, ... ]
</span><span style="color:#eeffff;">    collection
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">flat_map</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">map</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">map.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">())
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">filter</span><span style="color:#89ddff;">(|&amp;(</span><span style="color:#eeffff;">_</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> &amp;</span><span style="color:#f78c6c;">ele</span><span style="color:#89ddff;">)| </span><span style="color:#eeffff;">ele </span><span style="color:#89ddff;">==</span><span style="color:#eeffff;"> prog</span><span style="color:#89ddff;">)
</span><span style="color:#eeffff;">        .</span><span style="color:#82aaff;">count</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>flat_map</code> 的作用：用于将每个 HashMap 转换成一个迭代器</li>
<li>问题：为什么不能直接对 HashMap 调用 <code>.iter()</code> ？ 就是直接 <code>collection.iter().iter()</code> 不行吗？
<ul>
<li>为了遍历切片中的每个 <code>HashMap</code>，你可以使用 <code>.iter()</code> 方法来遍历切片本身，然后再使用 <code>.iter()</code> 方法来遍历每个 <code>HashMap</code>。这就是代码中使用 <code>flat_map()</code> 的原因，它允许你将两层迭代器（切片和哈希映射内部的迭代器）"平铺"成一个单层迭代器，以便于后续的操作。如果直接使用 <code>collection.iter().iter()</code>，会导致类型不匹配错误，因为 <code>collection.iter()</code> 返回的是一个切片迭代器，而不是 <code>HashMap</code> 的迭代器。</li>
</ul>
</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> words </span><span style="color:#89ddff;">= ["</span><span style="color:#c3e88d;">alpha</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">beta</span><span style="color:#89ddff;">", "</span><span style="color:#c3e88d;">gamma</span><span style="color:#89ddff;">"];
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// chars() 返回一个迭代器
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> merged</span><span style="color:#89ddff;">: </span><span style="color:#ffcb6b;">String </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> words.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()  </span><span style="font-style:italic;color:#546e7a;">// get "alpha"
</span><span style="color:#eeffff;">                          .</span><span style="color:#82aaff;">flat_map</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">s</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">s.</span><span style="color:#82aaff;">chars</span><span style="color:#89ddff;">())  
</span><span style="color:#eeffff;">                          .</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">merged</span><span style="color:#89ddff;">, "</span><span style="color:#c3e88d;">alphabetagamma</span><span style="color:#89ddff;">");
</span></pre>

<ul>
<li>这边看似也是一个连续 <code>.iter()</code> 的例子，先 <code>.iter()</code> 获取第一个值 "alpha"</li>
<li><code>"alpha"</code> 再取 <code>.chars()</code> , .<code>chars()</code> 也返回一个迭代器</li>
</ul>
<p>或者这么写（但是推荐 <code>flat_map</code>, 它可以更清楚地传达意图）：</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> merged</span><span style="color:#89ddff;">: </span><span style="color:#ffcb6b;">String </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> words.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">                          .</span><span style="color:#82aaff;">map</span><span style="color:#89ddff;">(|</span><span style="color:#f78c6c;">s</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">s.</span><span style="color:#82aaff;">chars</span><span style="color:#89ddff;">())
</span><span style="color:#eeffff;">                          .</span><span style="color:#82aaff;">flatten</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">                          .</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span></pre>

<hr>
<p>map + ? :
如下的需求是将一个 定长数组 <code>[i16;3]</code> 转换成一个 Color struct 类型</p>
<ul>
<li>因为 定长数组 <code>[i16;3]</code>是在栈上分配的，所以函数拥有所有权（直接复制一份原值过来的）</li>
<li><code>arr.iter()</code> 后，获取了迭代器里每个值的 Ref，所以仍需要用 &amp;d 匹配解包，获取实际值</li>
<li>在 map 中我们做如下处理：
<ul>
<li>如果值是 0~255 则不做什么，直接转成 u8 类型</li>
<li>如果值不在这个范围内，则返回一个错误</li>
<li>因为错误类型 和 u8 不一样，所以考虑用 Result Wrap 起来</li>
</ul>
</li>
<li>因为我们不关系错误类型，且想把 map 处理后的数组返回给新数组，所以最后使用  <code>?</code>  解包</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#546e7a;">// [255, 1, -1]
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">try_from</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">arr</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> [</span><span style="font-style:italic;color:#c792ea;">i16</span><span style="color:#eeffff;">; 3]</span><span style="color:#89ddff;">) -&gt; </span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">Self</span><span style="color:#eeffff;">, </span><span style="font-style:italic;color:#c792ea;">Self</span><span style="font-style:italic;color:#89ddff;">::</span><span style="color:#eeffff;">Error</span><span style="color:#89ddff;">&gt; {
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> arr_ </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> arr.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">map</span><span style="color:#89ddff;">(|&amp;</span><span style="color:#f78c6c;">d</span><span style="color:#89ddff;">| {
</span><span style="color:#eeffff;">		</span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> d </span><span style="color:#89ddff;">&lt; </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">||</span><span style="color:#eeffff;"> d </span><span style="color:#89ddff;">&gt; </span><span style="color:#f78c6c;">255 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">			</span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">IntoColorError</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">IntConversion</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">		</span><span style="color:#89ddff;">} </span><span style="font-style:italic;color:#c792ea;">else </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">			</span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">d </span><span style="color:#89ddff;">as </span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">		</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">})</span><span style="color:#eeffff;">.collect</span><span style="color:#89ddff;">::&lt;</span><span style="color:#eeffff;">Result</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="font-style:italic;color:#c792ea;">u8</span><span style="color:#89ddff;">&gt;</span><span style="color:#eeffff;">, </span><span style="color:#89ddff;">_&gt;&gt;()?;
</span><span style="color:#eeffff;">	
</span><span style="color:#eeffff;">	</span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Color </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">		red</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> arr_</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">],
</span><span style="color:#eeffff;">		green</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> arr_</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">],
</span><span style="color:#eeffff;">		blue</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> arr_</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">2</span><span style="color:#89ddff;">],
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">})
</span></pre>

<h4>smart pointers</h4>
<h5>Box</h5>
<ul>
<li>At compile time, Rust needs to know how much space a type takes up. This becomes problematic for recursive types, where a value can have as part of itself another value of the same type.</li>
<li>To get around the issue, we can use a <code>Box</code> - a smart pointer used to store data on the heap, which also allows us to wrap a recursive type.</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#eeffff;">Solution ✅
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">PartialEq</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Debug</span><span style="color:#89ddff;">)]
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">List </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    Cons</span><span style="color:#89ddff;">(</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">, </span><span style="color:#eeffff;">Box</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">List</span><span style="color:#89ddff;">&gt;),
</span><span style="color:#eeffff;">    Nil</span><span style="color:#89ddff;">,
</span><span style="color:#89ddff;">}
</span></pre>

<pre style="background-color:#263238;"><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">create_empty_list</span><span style="color:#89ddff;">() -&gt;</span><span style="color:#eeffff;"> List </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    List</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Nil </span><span style="font-style:italic;color:#546e7a;">// 空列表
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#c792ea;">pub </span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">create_non_empty_list</span><span style="color:#89ddff;">() -&gt;</span><span style="color:#eeffff;"> List </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> tail </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">List</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Cons</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">42</span><span style="color:#89ddff;">, </span><span style="color:#ffcb6b;">Box</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">List</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Nil</span><span style="color:#89ddff;">)); </span><span style="font-style:italic;color:#546e7a;">// 非空 List
</span><span style="color:#eeffff;">    List</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Cons</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">23</span><span style="color:#89ddff;">, </span><span style="color:#ffcb6b;">Box</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">tail</span><span style="color:#89ddff;">)) </span><span style="font-style:italic;color:#546e7a;">// 创建头部节点，并连接到尾部
</span><span style="color:#89ddff;">}
</span></pre>

<h5>Arc</h5>
<ul>
<li>使用 Arc（原子引用计数）在多个线程之间安全共享一个数字向量</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> numbers</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;_&gt; = (</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">..</span><span style="color:#f78c6c;">100</span><span style="font-style:italic;color:#c792ea;">u32</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> shared_numbers </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Arc</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">numbers</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> joinhandles </span><span style="color:#89ddff;">= </span><span style="color:#ffcb6b;">Vec</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> offset </span><span style="color:#89ddff;">in </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">..</span><span style="color:#f78c6c;">8 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> child_numbers </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Arc</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">clone</span><span style="color:#89ddff;">(&amp;</span><span style="color:#eeffff;">shared_numbers</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">        joinhandles.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">thread</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">spawn</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">move </span><span style="color:#89ddff;">|| {
</span><span style="color:#eeffff;">            </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> sum</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u32 </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> child_numbers.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">filter</span><span style="color:#89ddff;">(|&amp;&amp;</span><span style="color:#f78c6c;">n</span><span style="color:#89ddff;">| </span><span style="color:#eeffff;">n </span><span style="color:#89ddff;">% </span><span style="color:#f78c6c;">8 </span><span style="color:#89ddff;">==</span><span style="color:#eeffff;"> offset</span><span style="color:#89ddff;">)</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">sum</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">            println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Sum of offset </span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;"> is </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> offset</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> sum</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}));
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> handle </span><span style="color:#89ddff;">in</span><span style="color:#eeffff;"> joinhandles.</span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        handle.</span><span style="color:#82aaff;">join</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">unwrap</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span></pre>

<ul>
<li><code>let child_numbers = ...</code>: 在循环内部，创建新的 Arc（<code>child_numbers</code>），它是 <code>shared_numbers</code> Arc 的 clone , 每个线程需要自己的 Arc，因为不安全的是在多个可能并发修改的线程之间共享单个 Arc , <code>Arc::clone</code> 方法增加了引用计数，允许多个线程安全地共享对相同数据的只读访问</li>
<li><code>joinhandles.push(thread::spawn(...))</code>: 这一行生成一个新线程，并且传递给<code> thread::spawn</code>的闭包包含将在该线程中运行的代码。闭包捕获了<code>child_numbers</code> Arc，确保每个线程都在自己的向量克隆上操作</li>
</ul>
<h4>Thread</h4>
<p>使用<code>thread::spawn</code>来创建线程时，它返回一个<code>JoinHandle</code>，你可以使用它来等待线程完成并获取其返回值。在你的代码中，你可以修改<code>for</code>循环来收集线程的返回值，然后使用<code>join</code>方法等待它们完成。</p>
<h5>Basic</h5>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> handles </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> i </span><span style="color:#89ddff;">in </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">..</span><span style="color:#f78c6c;">10 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        handles.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">thread</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">spawn</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">move </span><span style="color:#89ddff;">|| {
</span><span style="color:#eeffff;">            </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> start </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Instant</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">now</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">            thread</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">sleep</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Duration</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from_millis</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">250</span><span style="color:#89ddff;">));
</span><span style="color:#eeffff;">            println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">thread </span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;"> is complete</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> i</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">            start.</span><span style="color:#82aaff;">elapsed</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">as_millis</span><span style="color:#89ddff;">()
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}));
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> results</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">u128</span><span style="color:#89ddff;">&gt; = </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[];
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> handle </span><span style="color:#89ddff;">in</span><span style="color:#eeffff;"> handles </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#546e7a;">// TODO: a struct is returned from thread::spawn, can you use it?
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> result </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> handle.</span><span style="color:#82aaff;">join</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">expect</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Thread panicked!</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">        results.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">result</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> results.</span><span style="color:#82aaff;">len</span><span style="color:#89ddff;">() != </span><span style="color:#f78c6c;">10 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        panic!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Oh no! All the spawned threads did not finish!</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">for </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">i</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> result</span><span style="color:#89ddff;">) in</span><span style="color:#eeffff;"> results.</span><span style="color:#82aaff;">into_iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">enumerate</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">        println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">thread </span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;"> took </span><span style="color:#eeffff;">{}</span><span style="color:#c3e88d;">ms</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> i</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> result</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span></pre>

<h5>Mutex</h5>
<p>Rust中如何在多个线程间正确共享和更新数据:</p>
<ul>
<li>使用<code>Mutex</code>把共享的<code>JobStatus</code>包起来,以协调多个线程之间的访问。</li>
<li>每个线程在更新值之前获取锁。</li>
<li>主线程用<code>join()</code>等待所有线程完成。</li>
<li>最后在所有线程都结束后打印更新后的最终值。</li>
</ul>
<p>这样可以确保从多个线程正确地更新共享的值。线程之间通过 mutex 的锁进行同步。</p>
<p>如果没有mutex,线程会竞争去更新这个值,可能导致更新不一致。通过在更新之前获取锁,可以避免这个竞争条件。</p>
<p>通过 mutex 的锁机制可以协调多个线程之间对共享数据的访问,确保线程安全。</p>
<pre style="background-color:#263238;"><span style="color:#c792ea;">use </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">sync</span><span style="color:#89ddff;">::{</span><span style="color:#eeffff;">Arc</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> Mutex</span><span style="color:#89ddff;">};
</span><span style="color:#c792ea;">use </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">thread</span><span style="color:#89ddff;">;
</span><span style="color:#c792ea;">use </span><span style="color:#eeffff;">std</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">time</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Duration</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">struct </span><span style="color:#eeffff;">JobStatus </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">  jobs_completed</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">u32</span><span style="color:#eeffff;">,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> status </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Arc</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Mutex</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">new</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">JobStatus </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> jobs_completed</span><span style="color:#89ddff;">: </span><span style="color:#f78c6c;">0 </span><span style="color:#89ddff;">}));
</span><span style="color:#eeffff;">  
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> handles </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">vec!</span><span style="color:#89ddff;">[];
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">for </span><span style="color:#89ddff;">_ in </span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">..</span><span style="color:#f78c6c;">10 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> status_shared </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">Arc</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">clone</span><span style="color:#89ddff;">(&amp;</span><span style="color:#eeffff;">status</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> handle </span><span style="color:#89ddff;">= </span><span style="color:#eeffff;">thread</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">spawn</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">move </span><span style="color:#89ddff;">|| {
</span><span style="color:#eeffff;">      thread</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">sleep</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Duration</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">from_millis</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">250</span><span style="color:#89ddff;">));
</span><span style="color:#eeffff;">      
</span><span style="color:#eeffff;">      </span><span style="font-style:italic;color:#546e7a;">// Acquire lock before updating shared status
</span><span style="color:#eeffff;">      </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> status_mutex </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> status_shared.</span><span style="color:#82aaff;">lock</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">unwrap</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">      status_mutex.jobs_completed </span><span style="color:#89ddff;">+= </span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">});
</span><span style="color:#eeffff;">    handles.</span><span style="color:#82aaff;">push</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">handle</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> handle </span><span style="color:#89ddff;">in</span><span style="color:#eeffff;"> handles </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    handle.</span><span style="color:#82aaff;">join</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">unwrap</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">  </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#546e7a;">// Print final updated value
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> status </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> status.</span><span style="color:#82aaff;">lock</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">unwrap</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">  println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">jobs completed </span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> status.jobs_completed</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<h5>Mutex mpsc..?</h5>
<p>使用多线程和通道来处理一个队列并进行数据传输，最终验证是否成功接收了所有数据</p>
<ul>
<li><code>Queue</code> 结构体表示一个队列，其中包含一个长度字段和两个包含整数的向量 <code>first_half</code> 和 <code>second_half</code></li>
<li><code>send_tx</code> 函数接受一个 <code>Queue</code> 和一个 <code>Arc&lt;Mutex&lt;mpsc::Sender&lt;u32&gt;&gt;&gt;</code>，它用于将数据发送到通道。该函数将 <code>Queue</code> 的两个向量中的数据发送到通道中。
<ul>
<li><code>Arc&lt;Mutex&lt;mpsc::Sender&lt;u32&gt;&gt;&gt;</code>：这是一个包装了发送者通道的 <code>Arc</code>，它允许多个线程共享并安全地访问发送者通道</li>
</ul>
</li>
</ul>
<h4>Macro</h4>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">macro_use</span><span style="color:#89ddff;">]
</span><span style="font-style:italic;color:#c792ea;">mod </span><span style="color:#eeffff;">macros </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="color:#82aaff;">macro_rules! </span><span style="color:#eeffff;">my_macro </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">() =&gt; {
</span><span style="color:#eeffff;">            println!</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">Check out my macro!</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">}</span><span style="color:#eeffff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    my_macro!</span><span style="color:#89ddff;">();
</span><span style="color:#89ddff;">}
</span></pre>

<h4>Other small tips</h4>
<p><strong>as ref:</strong></p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">average</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">values</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">[</span><span style="font-style:italic;color:#c792ea;">f64</span><span style="color:#eeffff;">]</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">f64 </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> total </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> values.</span><span style="color:#82aaff;">iter</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.sum</span><span style="color:#89ddff;">::&lt;</span><span style="font-style:italic;color:#c792ea;">f64</span><span style="color:#89ddff;">&gt;();
</span><span style="color:#eeffff;">    total </span><span style="color:#89ddff;">/</span><span style="color:#eeffff;"> values.</span><span style="color:#82aaff;">len</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">❌ </span><span style="color:#89ddff;">^</span><span style="color:#eeffff;"> no implementation </span><span style="font-style:italic;color:#c792ea;">for</span><span style="color:#eeffff;"> `</span><span style="font-style:italic;color:#c792ea;">f64 </span><span style="color:#89ddff;">/ </span><span style="font-style:italic;color:#c792ea;">usize</span><span style="color:#eeffff;">`
</span></pre>

<ul>
<li>Error reason: <code>values.len()</code> is usize</li>
<li>✅ fix:   total / values.len() <strong>as f64</strong></li>
</ul>
<p><strong>&amp;str.split()</strong></p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">from</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">s</span><span style="color:#89ddff;">: &amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">) -&gt;</span><span style="color:#eeffff;"> Person </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">if</span><span style="color:#eeffff;"> s.</span><span style="color:#82aaff;">is_empty</span><span style="color:#89ddff;">(){ </span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#eeffff;">Person</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">default</span><span style="color:#89ddff;">()}
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> parts </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> s.</span><span style="color:#82aaff;">split</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">,</span><span style="color:#89ddff;">");
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">name</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> age</span><span style="color:#89ddff;">) =</span><span style="color:#eeffff;"> parts</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">❌ Split</span><span style="color:#89ddff;">&lt;</span><span style="color:#eeffff;">'</span><span style="color:#89ddff;">_</span><span style="color:#eeffff;">, </span><span style="color:#89ddff;">&amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">&gt; ,</span><span style="color:#eeffff;"> found `</span><span style="color:#89ddff;">(_, _)</span><span style="color:#eeffff;">`
</span><span style="color:#eeffff;">✅ Solution ： 
</span><span style="color:#eeffff;">  </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> parts</span><span style="color:#89ddff;">: </span><span style="color:#eeffff;">Vec</span><span style="color:#89ddff;">&lt;&amp;</span><span style="font-style:italic;color:#c792ea;">str</span><span style="color:#89ddff;">&gt; =</span><span style="color:#eeffff;"> s.</span><span style="color:#82aaff;">split</span><span style="color:#89ddff;">("</span><span style="color:#c3e88d;">,</span><span style="color:#89ddff;">")</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">collect</span><span style="color:#89ddff;">();
</span></pre>

<ul>
<li>Error reason: <code>split</code> 返回的是一个 Iterator</li>
<li>✅ fix:</li>
</ul>
<p><strong>&amp;str.parse()</strong></p>
<ul>
<li>需求：将 "26"  这个 <code>&amp;str</code> 转化为 <code>uszie</code> number</li>
</ul>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> age </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> age_str.parse</span><span style="color:#89ddff;">::&lt;</span><span style="font-style:italic;color:#c792ea;">usize</span><span style="color:#89ddff;">&gt;()?;
</span><span style="color:#eeffff;">❌ </span><span style="color:#89ddff;">^</span><span style="color:#eeffff;"> cannot </span><span style="color:#c792ea;">use</span><span style="color:#eeffff;"> the `</span><span style="color:#89ddff;">?</span><span style="color:#eeffff;">` operator </span><span style="color:#89ddff;">in</span><span style="color:#eeffff;"> a method that returns `Person`
</span></pre>

<ul>
<li>Error reason: <code>parse::&lt;usize&gt;()</code> 返回的是一个 <code>Result</code> , 需要对 <code>Ok()</code> 进行处理</li>
<li>fix
<ul>
<li>法 1:  使用 match 的<code> Ok(age) , Err(_)</code> 分支处理</li>
<li>法 1:  使用 <code>.ok().unwrap_or_else</code></li>
</ul>
</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#eeffff;">✅ Solution</span><span style="color:#89ddff;">-</span><span style="color:#f78c6c;">1
</span><span style="color:#eeffff;">	</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> age </span><span style="color:#89ddff;">= </span><span style="font-style:italic;color:#c792ea;">match</span><span style="color:#eeffff;"> age_str.parse</span><span style="color:#89ddff;">::&lt;</span><span style="font-style:italic;color:#c792ea;">usize</span><span style="color:#89ddff;">&gt;() {
</span><span style="color:#eeffff;">		</span><span style="color:#ffcb6b;">Ok</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">age</span><span style="color:#89ddff;">) =&gt;</span><span style="color:#eeffff;"> age</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">		</span><span style="color:#ffcb6b;">Err</span><span style="color:#89ddff;">(_) =&gt; {
</span><span style="color:#eeffff;">			</span><span style="font-style:italic;color:#c792ea;">return </span><span style="color:#eeffff;">Person</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">default</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">		</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">	</span><span style="color:#89ddff;">};
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">✅ Solution</span><span style="color:#89ddff;">-</span><span style="color:#f78c6c;">1
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> age </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> age_str.parse</span><span style="color:#89ddff;">::&lt;</span><span style="font-style:italic;color:#c792ea;">usize</span><span style="color:#89ddff;">&gt;()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">ok</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">unwrap_or_else</span><span style="color:#89ddff;">(|| </span><span style="color:#eeffff;">Person</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">default</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.age</span><span style="color:#89ddff;">);
</span></pre>

<p>元组解包 <code>let (a, b) = (..)</code> :</p>
<pre style="background-color:#263238;"><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> name </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> parts</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">];
</span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> age_str </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> parts</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">];
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// ✅ 语法优化：
</span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">name</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> age_str</span><span style="color:#89ddff;">) = (</span><span style="color:#eeffff;">parts</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">0</span><span style="color:#89ddff;">]</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">trim</span><span style="color:#89ddff;">(),</span><span style="color:#eeffff;"> parts</span><span style="color:#89ddff;">[</span><span style="color:#f78c6c;">1</span><span style="color:#89ddff;">]</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">trim</span><span style="color:#89ddff;">());
</span></pre>

<pre style="background-color:#263238;"><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">100</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> y </span><span style="color:#89ddff;">= &amp;</span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> z </span><span style="color:#89ddff;">= &amp;</span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;">y </span><span style="color:#89ddff;">+= </span><span style="color:#f78c6c;">100</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;">z </span><span style="color:#89ddff;">+= </span><span style="color:#f78c6c;">1000</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">1200</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">============================&gt;
</span><span style="color:#eeffff;">
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">test</span><span style="color:#89ddff;">]
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let </span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> x </span><span style="color:#89ddff;">= </span><span style="color:#f78c6c;">100</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">{   
</span><span style="color:#eeffff;">        </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> y </span><span style="color:#89ddff;">= &amp;</span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">        </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;">y </span><span style="color:#89ddff;">+= </span><span style="color:#f78c6c;">100</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> z </span><span style="color:#89ddff;">= &amp;</span><span style="color:#c792ea;">mut</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    </span><span style="color:#89ddff;">*</span><span style="color:#eeffff;">z </span><span style="color:#89ddff;">+= </span><span style="color:#f78c6c;">1000</span><span style="color:#89ddff;">;
</span><span style="color:#eeffff;">    assert_eq!</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">x</span><span style="color:#89ddff;">, </span><span style="color:#f78c6c;">1200</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<hr>
<pre style="background-color:#263238;"><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    </span><span style="font-style:italic;color:#c792ea;">let</span><span style="color:#eeffff;"> data </span><span style="color:#89ddff;">= "</span><span style="color:#c3e88d;">Rust is great!</span><span style="color:#89ddff;">"</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">to_string</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">    </span><span style="color:#82aaff;">get_char</span><span style="color:#89ddff;">(&amp;</span><span style="color:#eeffff;">data</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    </span><span style="color:#82aaff;">string_uppercase</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">data</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// Should not take ownership
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">get_char</span><span style="color:#89ddff;">(</span><span style="color:#f78c6c;">data</span><span style="color:#89ddff;">: &amp;</span><span style="color:#eeffff;">String</span><span style="color:#89ddff;">) -&gt; </span><span style="font-style:italic;color:#c792ea;">char </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    data.</span><span style="color:#82aaff;">chars</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">last</span><span style="color:#89ddff;">()</span><span style="color:#eeffff;">.</span><span style="color:#82aaff;">unwrap</span><span style="color:#89ddff;">()
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#546e7a;">// Should take ownership
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">string_uppercase</span><span style="color:#89ddff;">(</span><span style="color:#c792ea;">mut </span><span style="color:#f78c6c;">data</span><span style="color:#89ddff;">:</span><span style="color:#eeffff;"> String</span><span style="color:#89ddff;">) {
</span><span style="color:#eeffff;">    data </span><span style="color:#89ddff;">=</span><span style="color:#eeffff;"> data.</span><span style="color:#82aaff;">to_uppercase</span><span style="color:#89ddff;">();
</span><span style="color:#eeffff;">
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{}</span><span style="color:#89ddff;">",</span><span style="color:#eeffff;"> data</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li>仔细观察 <code>&amp;</code> 和 <code>mut</code> 所在的位置</li>
<li>犯了低级错误：(mut data: &amp;String) ❌</li>
<li>犯了低级错误：(&amp;data: String) ❌</li>
</ul>
<hr>
<pre style="background-color:#263238;"><span style="color:#89ddff;"># </span><span style="font-style:italic;color:#c792ea;">enum
</span><span style="color:#89ddff;">#[</span><span style="color:#eeffff;">derive</span><span style="color:#89ddff;">(</span><span style="color:#eeffff;">Debug</span><span style="color:#89ddff;">)]
</span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">Message </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    Quit</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">    Echo</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">    Move</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">    ChangeColor</span><span style="color:#89ddff;">,
</span><span style="color:#89ddff;">}
</span><span style="color:#eeffff;">
</span><span style="font-style:italic;color:#c792ea;">fn </span><span style="color:#82aaff;">main</span><span style="color:#89ddff;">() {
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{:?}</span><span style="color:#89ddff;">", </span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Quit</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{:?}</span><span style="color:#89ddff;">", </span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Echo</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{:?}</span><span style="color:#89ddff;">", </span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">Move</span><span style="color:#89ddff;">);
</span><span style="color:#eeffff;">    println!</span><span style="color:#89ddff;">("</span><span style="color:#eeffff;">{:?}</span><span style="color:#89ddff;">", </span><span style="color:#eeffff;">Message</span><span style="color:#89ddff;">::</span><span style="color:#eeffff;">ChangeColor</span><span style="color:#89ddff;">);
</span><span style="color:#89ddff;">}
</span><span style="font-style:italic;color:#546e7a;">// Output:
</span><span style="font-style:italic;color:#546e7a;">// ====================
</span><span style="font-style:italic;color:#546e7a;">// Quit
</span><span style="font-style:italic;color:#546e7a;">// Echo
</span><span style="font-style:italic;color:#546e7a;">// Move
</span><span style="font-style:italic;color:#546e7a;">// ChangeColor
</span></pre>

<ul>
<li>enum 里的东西仔细看，Quit、Echo 、Move.. 现在都不需要明确定义。</li>
</ul>
<pre style="background-color:#263238;"><span style="color:#89ddff;">#</span><span style="color:#eeffff;"> 复杂枚举类型：
</span><span style="font-style:italic;color:#c792ea;">enum </span><span style="color:#eeffff;">Message </span><span style="color:#89ddff;">{
</span><span style="color:#eeffff;">    Quit</span><span style="color:#89ddff;">,
</span><span style="color:#eeffff;">    Move </span><span style="color:#89ddff;">{</span><span style="color:#eeffff;"> x</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">,</span><span style="color:#eeffff;"> y</span><span style="color:#89ddff;">: </span><span style="font-style:italic;color:#c792ea;">i32 </span><span style="color:#89ddff;">},  </span><span style="font-style:italic;color:#546e7a;">// 移动
</span><span style="color:#eeffff;">    Write</span><span style="color:#89ddff;">(</span><span style="color:#ffcb6b;">String</span><span style="color:#89ddff;">),
</span><span style="color:#eeffff;">    ChangeColor</span><span style="color:#89ddff;">(</span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">, </span><span style="font-style:italic;color:#c792ea;">i32</span><span style="color:#89ddff;">),
</span><span style="color:#89ddff;">}
</span></pre>

<ul>
<li><code>Quit</code> 是一个不携带任何额外数据的 variant</li>
<li>Move 结构体， 注意不是 <code>Move : {x, ..}</code>  &lt;-  没有 <code>Move :</code> 的那个冒号！！</li>
<li><code>Write</code> variant 携带了一个 <code>String</code> 类型的数据</li>
<li><code>ChangeColor</code> 是一个元组结构体</li>
</ul>

<ol>
<li id="fn-1">
<p>move 语义 <a href="#fnref-1" class="footnote-backref" rel="noopener noreferrer">↩</a></p>
</li>
</ol>



                </main>
            </div>

            <footer>
                
                    <a href="https://github.com/rust-lang/rustlings"><div class="github-icon" aria-hidden="true"></div></a>
                
                <span>
                    rustlings
                </span>
            </footer>
        </div>

        
            <script defer="true" data-domain="rustlings.cool" src="https://plausible.io/js/script.js"></script>
        
        

        

    <script src="/artifacts.js"></script>


    </body>
</html>